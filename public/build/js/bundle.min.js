if("/admin/configuracion/informacion"===window.location.pathname){const e=document.getElementById("btnActualizarInfo");function mostrarAlerta(e,t,o){Swal.fire({icon:o,title:e,text:t}).then(()=>{$(".modal").modal("hide"),location.reload()})}e&&e.addEventListener("click",(async function(t){t.preventDefault();const o={id:e.dataset.id,nombre:document.getElementById("nombre").value.trim(),telefono:document.getElementById("telefono").value.trim(),correo:document.getElementById("correo").value.trim(),ubicacion:document.getElementById("ubicacion").value.trim(),img:document.getElementById("logo").files[0]};try{const e=new FormData;Object.entries(o).forEach(([t,o])=>e.append(t,o));const t="/admin/configuracion/informacion/actualizar",n=await fetch(t,{method:"POST",body:e}),a=await n.json();mostrarAlerta(a.titulo,a.mensaje,a.tipo)}catch(e){console.log("error")}}))}if(window.mostrarAlerta=function(e,t,o){Swal.fire({icon:o,title:e,text:t}).then(()=>{$(".modal").modal("hide")})},window.mostrarAlerta2=function(e,t){const o=document.getElementById("mensaje-resultado");o.style.display="block",o.textContent=e,o.className="alert alert-"+("error"===t?"danger":"success"===t?"success":"info"),setTimeout(()=>{o.style.display="none"},5e3)},"/login"===window.location.pathname){const e=document.getElementById("btnIniciarSesion");e&&e.addEventListener("click",(async function(e){e.preventDefault();const t={email:document.getElementById("email").value.trim(),password:document.getElementById("password").value.trim()};if(""!==t.email&&""!==t.password)try{const e=new FormData;Object.entries(t).forEach(([t,o])=>e.append(t,o));const o="http://localhost:3000/login",n=await fetch(o,{method:"POST",body:e}),a=await n.json();a.autorizado?window.location.href="/admin/index":mostrarAlerta2(a.mensaje,a.tipo)}catch(e){console.log(e)}else mostrarAlerta2("Todos los campos son obligatorios","error")}))}if("/admin/configuracion/niveles"===window.location.pathname){let e,t=!1;const o={0:"Inactivo",1:"Activo"},n={destroy:!0,pageLength:5,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[4]}]};async function initDataTable(){t&&e.destroy();const o=await listarNiveles();o.length>0&&llenarTabla(o),e=$("#datatable_niveles").DataTable(n),t=!0}async function listarNiveles(){try{const e=await fetch("/api/niveles");return await e.json()}catch(e){return console.error("Error al obtener niveles:",e),[]}}function llenarTabla(e){const t=document.getElementById("tableBody_niveles");t.innerHTML="",e.forEach((e,n)=>{const a=o[e.estatus]||"Desconocido",r=`\n                <tr>\n                    <td>${n+1}</td>\n                    <td>${e.nombre}</td>\n                    <td>${e.numero}</td>\n                    <td class="text-center">${a}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarNivel" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarNivel">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarNivel" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=r})}initDataTable(),document.getElementById("tableBody_niveles").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarNivel")){const t=e.target.closest(".btn-eliminarNivel").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/niveles/"+t,o=await fetch(e,{method:"DELETE"}),n=await o.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),"success"===n.tipo&&await initDataTable()}catch(e){console.error(e)}}}));let a=null;document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarNivel")){const t=e.target.closest(".btnEditarNivel").dataset.id;a="";try{const e=await fetch("/api/niveles/"+t);if(!e.ok)throw new Error("Error al obtener nivel: "+e.statusText);const o=await e.json();a={...o},document.getElementById("nombreEditar").value=o.nombre,document.getElementById("numeroEditar").value=o.numero,document.getElementById("estatusEditar").value=o.estatus,document.querySelector(".btnActualizarNivel").dataset.id=t}catch(e){console.error("Error al obtener los datos del nivel:",e)}}})),document.getElementById("formEditarNivel").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarNivel").dataset.id,o={nombre:document.getElementById("nombreEditar").value.trim(),numero:document.getElementById("numeroEditar").value.trim(),estatus:document.getElementById("estatusEditar").value.trim()};if(!a)return console.error("Error: No hay datos originales del nivel"),void mostrarAlerta("Error","No se pudieron comparar los datos originales","error");let n={};if(o.nombre!==a.nombre&&(n.nombre=o.nombre),o.numero!==a.numero&&(n.numero=o.numero),o.estatus!==a.estatus&&(n.estatus=o.estatus),0===Object.keys(n).length)return void mostrarAlerta2("No hay cambios por enviar","error");const r=3===Object.keys(n).length?"PUT":"PATCH",i="PUT"===r?o:n;try{const e=await fetch("/api/niveles/"+t,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!e.ok){const t=await e.json();throw new Error(t.mensaje||"Error desconocido al actualizar")}const o=await e.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),initDataTable()}catch(e){console.error("Error al actualizar nivel:",e),mostrarAlerta("Error",e.message,"error")}}));document.querySelector(".btnSubirNivel").addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),numero:document.getElementById("numero").value.trim(),estatus:document.getElementById("estatus").value.trim()};if(""!==t.nombre&&""!==t.numero)try{const e=new FormData;Object.entries(t).forEach(([t,o])=>e.append(t,o));const o=await fetch("/api/niveles",{method:"POST",body:e}),n=await o.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),initDataTable(),document.getElementById("nombre").value="",document.getElementById("numero").value="",document.getElementById("estatus").value=""}catch(e){console.error("Error en la solicitud:",e)}else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/registro"===window.location.pathname){const e=document.getElementById("crear-cuenta");e&&e.addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),apellidos:document.getElementById("apellidos").value.trim(),email:document.getElementById("email").value.trim(),password:document.getElementById("password").value.trim(),password2:document.getElementById("password2").value.trim(),telefono:document.getElementById("telefono").value.trim(),direccion:document.getElementById("direccion").value.trim()};if(""!==t.email&&""!==t.nombre&&""!==t.direccion&&""!==t.password&&""!==t.password2&&""!==t.telefono)if(t.password===t.password2){delete t.password2;try{const e=new FormData;Object.entries(t).forEach(([t,o])=>e.append(t,o));const o="http://localhost:3000/registro",n=await fetch(o,{method:"POST",body:e}),a=await n.json();mostrarAlerta(a.titulo,a.mensaje,a.tipo)}catch(e){console.log("Error en la solicitud:",e)}}else mostrarAlerta2("Las contraseñas no coinciden","error");else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/admin/usuarios"===window.location.pathname){let e,t=!1;const o={1:"Administrador",2:"General",3:"Limpieza"},n={0:"Inactivo",1:"Activo"},a={destroy:!0,pageLength:5,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[3,8]},{visible:!1,targets:[7]}]};async function initDataTable(){t&&e.destroy();const o=await listarUsers();o.length>0&&llenarTabla(o),e=$("#datatable_users").DataTable(a),t=!0}async function listarUsers(){try{const e=await fetch("/api/usuarios");return await e.json()}catch(e){return console.error("Error al obtener usuarios:",e),[]}}function llenarTabla(e){const t=document.getElementById("tableBody_users");t.innerHTML="",e.forEach((e,a)=>{const r=o[e.rol_id]||"Desconocido",i=n[e.estatus]||"Desconocido",l=`\n                <tr>\n                    <td>${a+1}</td>\n                    <td><img src="/build/img/${e.img}.png" alt="Descripción de la imagen" width="65"></td>\n                    <td>${e.nombre}</td>\n                    <td>${e.apellido}</td>\n                    <td>${e.direccion}</td>\n                    <td>${e.email}</td>\n                    <td>${e.telefono}</td>\n                    <td>******</td> \x3c!-- Ocultamos la contraseña en opciones de la tabla --\x3e\n                    <td>${r}</td>\n                    <td class="text-center">${i}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarUsuario" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#usuarioEditarModal">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarUsuario" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=l})}initDataTable(),document.getElementById("tableBody_users").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarUsuario")){const t=e.target.closest(".btn-eliminarUsuario").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/usuarios/"+t,o=await fetch(e,{method:"DELETE"}),n=await o.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),"success"===n.tipo&&await initDataTable()}catch(e){console.error(e)}}})),document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarUsuario")){const t=e.target.closest(".btnEditarUsuario").dataset.id;try{const e=await fetch("/api/usuarios/"+t);if(!e.ok)throw new Error("Error al obtener usuario: "+e.statusText);const o=await e.json();document.getElementById("nombreEditar").value=o.nombre,document.getElementById("apellidoEditar").value=o.apellido,document.getElementById("direccionEditar").value=o.direccion,document.getElementById("emailEditar").value=o.email,document.getElementById("telefonoEditar").value=o.telefono,document.getElementById("rol_idEditar").value=o.rol_id,document.getElementById("estatusEditar").value=o.estatus;document.getElementById("imgEditar").src=o.img?`/build/img/${o.img}.png`:"/build/img/default.png",document.querySelector(".btnActualizarUsuario").dataset.id=t,$("#usuarioEditarModal").modal("show")}catch(e){console.error("Error al obtener los datos del usuario:",e)}}})),document.getElementById("formEditarUsuario").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarUsuario").dataset.id,o={nombre:document.getElementById("nombreEditar").value.trim(),apellido:document.getElementById("apellidoEditar").value.trim(),direccion:document.getElementById("direccionEditar").value.trim(),email:document.getElementById("emailEditar").value.trim(),telefono:document.getElementById("telefonoEditar").value.trim(),password:document.getElementById("passwordEditar").value.trim(),password2:document.getElementById("password2Editar").value.trim(),rol_id:document.getElementById("rol_idEditar").value.trim(),estatus:document.getElementById("estatusEditar").value.trim(),img:document.getElementById("logoEditar").files[0]};if(o.password===o.password2)if(o.telefono.length>10)mostrarAlerta("Error","Telefono no valido","error");else{delete o.password2;try{const e=new FormData;Object.entries(o).forEach(([t,o])=>e.append(t,o));const n=await fetch("/api/usuarios/"+t,{method:"POST",body:e}),a=await n.json();mostrarAlerta(a.titulo,a.mensaje,a.tipo),initDataTable()}catch(e){console.error("Error al actualizar usuario:",e)}}else mostrarAlerta("Error","Las contraseñas no coinciden.","error")}));document.querySelector(".btnSubirUsuario").addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),apellido:document.getElementById("apellido").value.trim(),direccion:document.getElementById("direccion").value.trim(),email:document.getElementById("email").value.trim(),telefono:document.getElementById("telefono").value.trim(),password:document.getElementById("password").value.trim(),password2:document.getElementById("password2").value.trim(),rol_id:document.getElementById("rol_id").value.trim(),estatus:document.getElementById("estatus").value.trim(),img:document.getElementById("logo").files[0]};if(""===t.email||""===t.nombre||""===t.direccion||""===t.password||""===t.password2||""===t.telefono)return void mostrarAlerta2("Todos los campos son necesarios","error");if(t.password!==t.password2)return void mostrarAlerta2("Las contraseñas no coinciden.","error");if(t.telefono.length>10)return void mostrarAlerta2("Telefono no valido","error");if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)){delete t.password2;try{const e=new FormData;Object.entries(t).forEach(([t,o])=>e.append(t,o));const o=await fetch("/api/usuarios",{method:"POST",body:e}),n=await o.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),initDataTable()}catch(e){console.error("Error en la solicitud:",e)}}else mostrarAlerta2("El correo electrónico no tiene un formato válido.","error")}))}
//# sourceMappingURL=bundle.js.map
