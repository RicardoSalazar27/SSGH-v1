if("/admin/configuracion/informacion"===window.location.pathname){const e=document.getElementById("btnActualizarInfo");function mostrarAlerta(e,t,a){Swal.fire({icon:a,title:e,text:t}).then(()=>{$(".modal").modal("hide"),location.reload()})}e&&e.addEventListener("click",(async function(t){t.preventDefault();const a={id:e.dataset.id,nombre:document.getElementById("nombre").value.trim(),telefono:document.getElementById("telefono").value.trim(),correo:document.getElementById("correo").value.trim(),ubicacion:document.getElementById("ubicacion").value.trim(),img:document.getElementById("logo").files[0]};try{const e=new FormData;Object.entries(a).forEach(([t,a])=>e.append(t,a));const t="/admin/configuracion/informacion/actualizar",o=await fetch(t,{method:"POST",body:e}),n=await o.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo)}catch(e){console.log("error")}}))}if(window.mostrarAlerta=function(e,t,a){Swal.fire({icon:a,title:e,text:t}).then(()=>{$(".modal").modal("hide")})},window.mostrarAlerta2=function(e,t){const a=document.getElementById("mensaje-resultado");a.style.display="block",a.textContent=e,a.className="alert alert-"+("error"===t?"danger":"success"===t?"success":"info"),setTimeout(()=>{a.style.display="none"},5e3)},window.mostrarAlerta3=function(e,t,a){Swal.fire({icon:a,title:e,text:t,willClose:()=>{setTimeout(()=>{window.location.reload()},1e3)}}).then(()=>{$(".modal").modal("hide")})},"/login"===window.location.pathname){const e=document.getElementById("btnIniciarSesion");e&&e.addEventListener("click",(async function(e){e.preventDefault();const t={email:document.getElementById("email").value.trim(),password:document.getElementById("password").value.trim()};if(""!==t.email&&""!==t.password)try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a="http://localhost:3000/login",o=await fetch(a,{method:"POST",body:e}),n=await o.json();n.autorizado?window.location.href="/admin/index":mostrarAlerta2(n.mensaje,n.tipo)}catch(e){console.log(e)}else mostrarAlerta2("Todos los campos son obligatorios","error")}))}if("/admin/puntodeventa/catalogo"===window.location.pathname){let e,t=!1;const a={destroy:!0,pageLength:5,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[4]}]};async function initDataTable(){t&&e.destroy();const o=await listarProductos();o.length>0&&llenarTabla(o),e=$("#datatable_productos").DataTable(a),t=!0}async function listarProductos(){try{const e=await fetch("/api/productos");return await e.json()}catch(e){return console.error("Error al obtener los productos:",e),[]}}function llenarTabla(e){const t=document.getElementById("tableBody_productos");t.innerHTML="",e.forEach((e,a)=>{const o=`\n                <tr>\n                    <td>${a+1}</td>\n                    <td>${e.nombre}</td>\n                    <td>${e.precio}</td>\n                    <td class="text-center">${e.stock}</td>\n                    <td class="text-center">${e.categoria_producto_id.nombre}</td>\n                    <td class="text-center">${e.codigo_barras}</td>\n                    <td class="text-center">${e.proveedor}</td>\n                    <td><img src="/build/img/${e.foto}.png" alt="Descripción de la imagen" width="65"></td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarProducto" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarProducto">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarProducto" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=o})}initDataTable(),document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarProducto")){const t=e.target.closest(".btnEditarProducto").dataset.id;try{const e=await fetch("/api/productos/"+t);if(!e.ok)throw new Error("Error al obtener usuario: "+e.statusText);const a=await e.json();document.getElementById("nombreEditar").value=a.nombre,document.getElementById("precioEditar").value=a.precio,document.getElementById("stockEditar").value=a.stock,document.getElementById("categoria_idEditar").value=a.categoria_producto_id,document.getElementById("codigo_barrasEditar").value=a.codigo_barras,document.getElementById("proveedorEditar").value=a.proveedor;document.getElementById("imgEditarP").src=a.foto?`/build/img/${a.foto}.png`:"/build/img/default.png",document.querySelector(".btnActualizarProducto").dataset.id=t}catch(e){console.error("Error al obtener los datos del producto:",e)}}})),document.getElementById("formEditarProducto").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarProducto").dataset.id,a={nombre:document.getElementById("nombreEditar").value.trim(),precio:document.getElementById("precioEditar").value.trim(),stock:document.getElementById("stockEditar").value.trim(),categoria_producto_id:document.getElementById("categoria_idEditar").value.trim(),codigo_barras:document.getElementById("codigo_barrasEditar").value.trim(),proveedor:document.getElementById("proveedorEditar").value.trim(),foto:document.getElementById("fotoP").files[0]};if(a.nombre&&a.precio&&a.categoria_producto_id)try{const e=new FormData;Object.entries(a).forEach(([t,a])=>e.append(t,a));const o=await fetch("/api/productos/"+t,{method:"POST",body:e}),n=await o.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo);const r=document.getElementById("fotoP");r.value="",r.value&&r.parentNode.replaceChild(r.cloneNode(!0),r),initDataTable()}catch(e){console.error("Error al actualizar producto:",e)}else mostrarAlerta("Error","No pueden ir vacios.","error")})),document.getElementById("tableBody_productos").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarProducto")){const t=e.target.closest(".btn-eliminarProducto").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/productos/"+t,a=await fetch(e,{method:"DELETE"}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),"success"===o.tipo&&await initDataTable()}catch(e){console.error(e)}}}));document.querySelector(".btnSubirProducto").addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),precio:document.getElementById("precio").value.trim(),stock:document.getElementById("stock").value.trim(),categoria_producto_id:document.getElementById("categoria_id").value.trim(),codigo_barras:document.getElementById("codigo_barras").value.trim(),proveedor:document.getElementById("proveedor").value.trim(),foto:document.getElementById("fotoPN").files[0]};if(""!==t.nombre&&""!==t.precio&&""!==t.stock&&""!==t.categoria_producto_id&&""!==t.codigo_barras)if(12==t.codigo_barras.length)try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a=await fetch("/api/productos",{method:"POST",body:e}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),initDataTable()}catch(e){console.error("Error en la solicitud:",e)}else mostrarAlerta2("Codigo UPC INvalido","error");else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/admin/configuracion/categorias"===window.location.pathname){let e,t=!1;const a={0:"Inactivo",1:"Activo"},o={destroy:!0,pageLength:5,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[7]}]};async function initDataTable(){t&&e.destroy();const a=await listarCategorias();a.length>0&&llenarTabla(a),e=$("#datatable_categorias").DataTable(o),t=!0}async function listarCategorias(){try{const e=await fetch("/api/categorias");if(204===e.status)return[];if(!e.ok)throw new Error("Error HTTP: "+e.status);return await e.json()}catch(e){return console.error("Error al obtener categorías:",e),null}}function llenarTabla(e){const t=document.getElementById("tableBody_categorias");t.innerHTML="",e.forEach((e,o)=>{const n=a[e.estado]||"Desconocido",r=`\n                <tr>\n                    <td>${o+1}</td>\n                    <td>${e.nombre}</td>\n                    <td class="text-center">${e.capacidad_maxima}</td>\n                    <td>${e.tipo_cama}</td>\n                    <td>${e.precio_base}</td>\n                    <td>${e.servicios_incluidos}</td>\n                    <td>${n}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarCategoria" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarCategoria">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarCategoria" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=r})}initDataTable(),document.getElementById("tableBody_categorias").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarCategoria")){const t=e.target.closest(".btn-eliminarCategoria").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/categorias/"+t,a=await fetch(e,{method:"DELETE"}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),"success"===o.tipo&&await initDataTable()}catch(e){console.error(e)}}}));let n=null;document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarCategoria")){const t=e.target.closest(".btnEditarCategoria").dataset.id;n=null;try{const e="/api/categorias/"+t,a=await fetch(e);if(!a.ok)throw new Error("Error al obtener categoria: "+a.statusText);const o=await a.json();n={...o},document.getElementById("nombreEditar").value=o.nombre,document.getElementById("capacidad_maximaEditar").value=o.capacidad_maxima,document.getElementById("tipo_camaEditar").value=o.tipo_cama,document.getElementById("precio_baseEditar").value=o.precio_base,document.getElementById("servicios_incluidosEditar").value=o.servicios_incluidos,document.getElementById("estadoEditar").value=o.estado,document.querySelector(".btnActualizarCategoria").dataset.id=t}catch(e){console.log("Error al obtener los datos de la categoria:",e)}}})),document.getElementById("formEditarCategoria").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarCategoria").dataset.id,a={nombre:document.getElementById("nombreEditar").value.trim(),capacidad_maxima:document.getElementById("capacidad_maximaEditar").value.trim(),tipo_cama:document.getElementById("tipo_camaEditar").value.trim(),precio_base:document.getElementById("precio_baseEditar").value.trim(),servicios_incluidos:document.getElementById("servicios_incluidosEditar").value.trim(),estado:document.getElementById("estadoEditar").value.trim()};if(!n)return console.error("Error: No hay datos originales de la categoria"),void mostrarAlerta("Error","No se pudieron comparar los datos originales","error");let o={};if(a.nombre!==n.nombre&&(o.nombre=a.nombre),a.capacidad_maxima!==n.capacidad_maxima&&(o.capacidad_maxima=a.capacidad_maxima),a.tipo_cama!==n.tipo_cama&&(o.tipo_cama=a.tipo_cama),a.precio_base!==n.precio_base&&(o.precio_base=a.precio_base),a.servicios_incluidos!==n.servicios_incluidos&&(o.servicios_incluidos=a.servicios_incluidos),a.estado!==n.estado&&(o.estado=a.estado),0===Object.keys(o).length)return void mostrarAlerta2("No hay cambios por enviar","error");const r=6===Object.keys(o).length?"PUT":"PATCH",i="PUT"===r?a:o;try{const e="/api/categorias/"+t,a=await fetch(e,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok){const e=await respuestaUpdate.json();throw new Error(e.mensaje||"Error desconocido al actualizar")}const o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),initDataTable()}catch(e){console.error("Error al actualizar nivel:",e),mostrarAlerta("Error",e.message,"error")}}));document.querySelector(".btnSubirCategoria").addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),capacidad_maxima:document.getElementById("capacidad_maxima").value.trim(),tipo_cama:document.getElementById("tipo_cama").value.trim(),precio_base:document.getElementById("precio_base").value.trim(),servicios_incluidos:document.getElementById("servicios_incluidos").value.trim(),estado:document.getElementById("estado").value.trim()};if(""!==t.nombre&&""!==t.capacidad_maxima&&""!==t.tipo_cama&&""!==t.precio_base)try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a=await fetch("/api/categorias",{method:"POST",body:e}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),initDataTable(),document.getElementById("nombre").value="",document.getElementById("capacidad_maxima").value="",document.getElementById("tipo_cama").value="",document.getElementById("servicios_incluidos").value="",document.getElementById("precio_base").value="",document.getElementById("estatado").value=""}catch(e){console.error("Error en la solicitud:",e)}else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/admin/clientes"===window.location.pathname){let e,t=!1;const a={destroy:!0,pageLength:5,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[6,7]}]};async function initDataTable(){t&&e.destroy();const o=await listarClientes();o.length>0&&llenarTabla(o),e=$("#datatable_clientes").DataTable(a),t=!0}async function listarClientes(){try{const e=await fetch("/api/clientes");if(204===e.status)return[];if(!e.ok)throw new Error("Error HTTP: "+e.status);return await e.json()}catch(e){return console.error("Error al obtener clientes:",e),null}}function llenarTabla(e){const t=document.getElementById("tableBody_clientes");t.innerHTML="",e.forEach((e,a)=>{const o=`\n                <tr>\n                    <td>${a+1}</td>\n                    <td>${e.nombre}</td>\n                    <td>${e.apellidos}</td>\n                    <td>${e.telefono}</td>\n                    <td>${e.correo}</td>\n                    <td>${e.direccion}</td>\n                    <td>${e.documento_identidad}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarCliente" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarCliente">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarCliente" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=o})}initDataTable();let o=null;document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarCliente")){const t=e.target.closest(".btnEditarCliente").dataset.id;o="";try{const e=await fetch("/api/clientes/"+t);if(!e.ok)throw new Error("Error al obtener cliente: "+e.statusText);const a=await e.json();o={...a},document.getElementById("nombre").value=a.nombre,document.getElementById("apellidos").value=a.apellidos,document.getElementById("direccion").value=a.direccion,document.getElementById("correo").value=a.correo,document.getElementById("telefono").value=a.telefono,document.getElementById("documento_identidad").value=a.documento_identidad,document.querySelector(".btnActualizarCliente").dataset.id=t}catch(e){console.error("Error al obtener los datos del cliente:",e)}}})),document.getElementById("formEditarCliente").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarCliente").dataset.id,a={nombre:document.getElementById("nombre").value.trim(),apellidos:document.getElementById("apellidos").value.trim(),telefono:document.getElementById("telefono").value.trim(),correo:document.getElementById("correo").value.trim(),direccion:document.getElementById("direccion").value.trim(),documento_identidad:document.getElementById("documento_identidad").value.trim()};if(!o)return console.error("Error: No hay datos originales del cliente"),void mostrarAlerta("Error","No se pudieron comparar los datos originales","error");let n={};if(a.nombre!==o.nombre&&(n.nombre=a.nombre),a.apellidos!==o.apellidos&&(n.apellidos=a.apellidos),a.telefono!==o.telefono&&(n.telefono=a.telefono),a.correo!==o.correo&&(n.correo=a.correo),a.direccion!==o.direccion&&(n.direccion=a.direccion),a.documento_identidad!==o.documento_identidad&&(n.documento_identidad=a.documento_identidad),0===Object.keys(n).length)return void mostrarAlerta2("No hay cambios por enviar","error");const r=6===Object.keys(n).length?"PUT":"PATCH",i="PUT"===r?a:n;try{const e=await fetch("/api/clientes/"+t,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!e.ok){const t=await e.json();throw new Error(t.mensaje||"Error desconocido al actualizar")}const a=await e.json();mostrarAlerta(a.titulo,a.mensaje,a.tipo),initDataTable()}catch(e){console.error("Error al actualizar cliente:",e),mostrarAlerta("Error",e.message,"error")}})),document.getElementById("tableBody_clientes").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarCliente")){const t=e.target.closest(".btn-eliminarCliente").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/clientes/"+t,a=await fetch(e,{method:"DELETE"}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),"success"===o.tipo&&await initDataTable()}catch(e){console.error(e)}}}))}if("/admin/configuracion/habitaciones"===window.location.pathname){let e,t=!1;const a={0:"Inactivo",1:"Activo"},o={destroy:!0,pageLength:5,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[4]}]};async function initDataTable(){t&&e.destroy();const a=await listarhabitaciones();a.length>0&&llenarTabla(a),e=$("#datatable_habitaciones").DataTable(o),t=!0}async function listarhabitaciones(){try{const e=await fetch("/api/habitaciones");return await e.json()}catch(e){return console.error("Error al obtener habitaciones:",e),[]}}function llenarTabla(e){const t=document.getElementById("tableBody_habitaciones");t.innerHTML="",e.forEach(e=>{const o=a[e.estatus]||"Desconocido",n=`\n                <tr>\n                    <td>${e.numero}</td>\n                    <td>${e.id_nivel.nombre}</td>\n                    <td>${e.id_categoria.nombre}</td>\n                    <td>${e.id_categoria.precio_base}</td>\n                    <td>${e.id_categoria.servicios_incluidos}</td>\n                    <td>${e.detalles_personalizados}</td>\n                    <td class="text-center">${o}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarHabitacion" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarHabitacion">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarHabitacion" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=n})}initDataTable(),document.getElementById("tableBody_habitaciones").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarHabitacion")){const t=e.target.closest(".btn-eliminarHabitacion").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/habitaciones/"+t,a=await fetch(e,{method:"DELETE"}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),"success"===o.tipo&&await initDataTable()}catch(e){console.error(e)}}}));let n=null;document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarHabitacion")){const t=e.target.closest(".btnEditarHabitacion").dataset.id;n="";try{const e=await fetch("/api/habitaciones/"+t);if(!e.ok)throw new Error("Error al obtener habitación: "+e.statusText);const a=await e.json();console.log(a),n={...a},document.getElementById("numeroEditar").value=a.numero,document.getElementById("id_nivelEditar").value=a.id_nivel.id,document.getElementById("id_categoriaEditar").value=a.id_categoria.id,document.getElementById("detalles_personalizadosEditar").value=a.detalles_personalizados,document.getElementById("estatusEditar").value=a.estatus,document.querySelector(".btnActualizarHabitacion").dataset.id=t}catch(e){console.error("Error al obtener los datos de la habitación:",e)}}})),document.getElementById("formEditarHabitacion").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarHabitacion").dataset.id,a={numero:document.getElementById("numeroEditar").value.trim(),id_nivel:document.getElementById("id_nivelEditar").value.trim(),id_categoria:document.getElementById("id_categoriaEditar").value.trim(),detalles_personalizados:document.getElementById("detalles_personalizadosEditar").value.trim(),estatus:document.getElementById("estatusEditar").value.trim()};if(!n)return console.error("Error: No hay datos originales del habitacion"),void mostrarAlerta("Error","No se pudieron comparar los datos originales","error");let o={};if(a.numero!==n.numero&&(o.numero=a.numero),a.id_nivel!==n.id_nivel&&(o.id_nivel=a.id_nivel),a.id_categoria!==n.id_categoria&&(o.id_categoria=a.id_categoria),a.detalles_personalizados!==n.detalles_personalizados&&(o.detalles_personalizados=a.detalles_personalizados),a.estatus!==n.estatus&&(o.estatus=a.estatus),0===Object.keys(o).length)return void mostrarAlerta2("No hay cambios por enviar","error");const r=a;try{const e=await fetch("/api/habitaciones/"+t,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok){const t=await e.json();throw new Error(t.mensaje||"Error desconocido al actualizar")}const a=await e.json();mostrarAlerta(a.titulo,a.mensaje,a.tipo),initDataTable()}catch(e){console.error("Error al actualizar habitacion:",e),mostrarAlerta("Error",e.message,"error")}}));document.querySelector(".btnSubirHabitacion").addEventListener("click",(async function(e){e.preventDefault();const t={numero:document.getElementById("numero").value.trim(),id_nivel:document.getElementById("id_nivel").value.trim(),id_categoria:document.getElementById("id_categoria").value.trim(),detalles_personalizados:document.getElementById("detalles_personalizados").value.trim(),estatus:document.getElementById("estatus").value.trim()};if(""!==t.id_nivel&&""!==t.numero&&""!==t.id_categoria)try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a=await fetch("/api/habitaciones",{method:"POST",body:e}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),initDataTable(),document.getElementById("numero").value="",document.getElementById("detalles_personalizados").value="",document.getElementById("estatus").value="1"}catch(e){console.error("Error en la solicitud:",e)}else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/admin/configuracion/niveles"===window.location.pathname){let e,t=!1;const a={0:"Inactivo",1:"Activo"},o={destroy:!0,pageLength:5,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[4]}]};async function initDataTable(){t&&e.destroy();const a=await listarNiveles();a.length>0&&llenarTabla(a),e=$("#datatable_niveles").DataTable(o),t=!0}async function listarNiveles(){try{const e=await fetch("/api/niveles");return await e.json()}catch(e){return console.error("Error al obtener niveles:",e),[]}}function llenarTabla(e){const t=document.getElementById("tableBody_niveles");t.innerHTML="",e.forEach((e,o)=>{const n=a[e.estatus]||"Desconocido",r=`\n                <tr>\n                    <td>${o+1}</td>\n                    <td>${e.nombre}</td>\n                    <td>${e.numero}</td>\n                    <td class="text-center">${n}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarNivel" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarNivel">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarNivel" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=r})}initDataTable(),document.getElementById("tableBody_niveles").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarNivel")){const t=e.target.closest(".btn-eliminarNivel").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/niveles/"+t,a=await fetch(e,{method:"DELETE"}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),"success"===o.tipo&&await initDataTable()}catch(e){console.error(e)}}}));let n=null;document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarNivel")){const t=e.target.closest(".btnEditarNivel").dataset.id;n="";try{const e=await fetch("/api/niveles/"+t);if(!e.ok)throw new Error("Error al obtener nivel: "+e.statusText);const a=await e.json();n={...a},document.getElementById("nombreEditar").value=a.nombre,document.getElementById("numeroEditar").value=a.numero,document.getElementById("estatusEditar").value=a.estatus,document.querySelector(".btnActualizarNivel").dataset.id=t}catch(e){console.error("Error al obtener los datos del nivel:",e)}}})),document.getElementById("formEditarNivel").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarNivel").dataset.id,a={nombre:document.getElementById("nombreEditar").value.trim(),numero:document.getElementById("numeroEditar").value.trim(),estatus:document.getElementById("estatusEditar").value.trim()};if(!n)return console.error("Error: No hay datos originales del nivel"),void mostrarAlerta("Error","No se pudieron comparar los datos originales","error");let o={};if(a.nombre!==n.nombre&&(o.nombre=a.nombre),a.numero!==n.numero&&(o.numero=a.numero),a.estatus!==n.estatus&&(o.estatus=a.estatus),0===Object.keys(o).length)return void mostrarAlerta2("No hay cambios por enviar","error");const r=3===Object.keys(o).length?"PUT":"PATCH",i="PUT"===r?a:o;try{const e=await fetch("/api/niveles/"+t,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!e.ok){const t=await e.json();throw new Error(t.mensaje||"Error desconocido al actualizar")}const a=await e.json();mostrarAlerta(a.titulo,a.mensaje,a.tipo),initDataTable()}catch(e){console.error("Error al actualizar nivel:",e),mostrarAlerta("Error",e.message,"error")}}));document.querySelector(".btnSubirNivel").addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),numero:document.getElementById("numero").value.trim(),estatus:document.getElementById("estatus").value.trim()};if(""!==t.nombre&&""!==t.numero)try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a=await fetch("/api/niveles",{method:"POST",body:e}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),initDataTable(),document.getElementById("nombre").value="",document.getElementById("numero").value="",document.getElementById("estatus").value=""}catch(e){console.error("Error en la solicitud:",e)}else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/registro"===window.location.pathname){const e=document.getElementById("crear-cuenta");e&&e.addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),apellidos:document.getElementById("apellidos").value.trim(),email:document.getElementById("email").value.trim(),password:document.getElementById("password").value.trim(),password2:document.getElementById("password2").value.trim(),telefono:document.getElementById("telefono").value.trim(),direccion:document.getElementById("direccion").value.trim()};if(""!==t.email&&""!==t.nombre&&""!==t.direccion&&""!==t.password&&""!==t.password2&&""!==t.telefono)if(t.password===t.password2){delete t.password2;try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a="http://localhost:3000/registro",o=await fetch(a,{method:"POST",body:e}),n=await o.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo)}catch(e){console.log("Error en la solicitud:",e)}}else mostrarAlerta2("Las contraseñas no coinciden","error");else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/admin/reservaciones"===window.location.pathname){const e=document.getElementById("searchEmail"),t=document.getElementById("sugerenciasCorreo"),a=document.getElementById("fechaEntrada"),o=document.getElementById("fechaSalida"),n=document.getElementById("habitacion"),r=document.getElementById("btnSiguiente"),i=document.getElementById("btnAtras"),d=document.getElementById("btnConfirmar"),c=document.getElementById("totalPagar"),l=document.getElementById("descuento"),s=document.getElementById("cobroExtra"),m=document.getElementById("adelanto");let u,g={},E=1,b=[],y=[];const f=new Choices(n,{removeItemButton:!0,placeholder:!0,placeholderValue:"Seleccione una o más habitaciones",searchEnabled:!1});async function buscarClientes(e){try{const t=await fetch("/api/clientes/correo/"+encodeURIComponent(e));return await t.json()}catch(e){return console.error("Error al obtener clientes:",e),[]}}function mostrarSugerencias(e){t.innerHTML="",0!==e.length?(t.classList.remove("d-none"),e.forEach(e=>{const a=document.createElement("li");a.classList.add("list-group-item","list-group-item-action"),a.textContent=e.correo,a.dataset.id=e.id,a.addEventListener("click",()=>seleccionarCliente(e)),t.appendChild(a)})):t.classList.add("d-none")}function seleccionarCliente(a){e.value=a.correo,document.getElementById("nombre").value=a.nombre,document.getElementById("apellidos").value=a.apellidos,document.getElementById("documento_identidad").value=a.documento_identidad,document.getElementById("telefono").value=a.telefono,document.getElementById("direccion").value=a.direccion,t.classList.add("d-none")}function guardarClienteNuevo(){g={correo:e.value.trim(),nombre:document.getElementById("nombre").value.trim(),apellidos:document.getElementById("apellidos").value.trim(),documento_identidad:document.getElementById("documento_identidad").value.trim(),telefono:document.getElementById("telefono").value.trim(),direccion:document.getElementById("direccion").value.trim()}}const p=document.getElementById("progressBar");function actualizarBarraProgreso(e){p.style.width=e+"%",p.setAttribute("aria-valuenow",e),p.textContent=e+"%"}function cambiarPaso(e){document.getElementById("step"+E).classList.add("d-none"),document.getElementById("step"+e).classList.remove("d-none"),E=e,i.classList.toggle("d-none",1===E),3===E?(r.textContent="Registrar",d.classList.remove("d-none"),r.classList.add("d-none")):(r.textContent="Siguiente",d.classList.add("d-none"),r.classList.remove("d-none"))}async function cargarHabitaciones(){if(a.value&&o.value)try{const e=await fetch(`/api/habitaciones/disponibles/${a.value}/${o.value}`);if(b=await e.json(),f.clearChoices(),0===b.length)return void f.setChoices([{value:"",label:"No hay habitaciones disponibles",disabled:!0}]);f.setChoices(b.map(e=>({value:e.id,label:`Habitación ${e.numero} | ${e.id_categoria.nombre} | Capacidad max. ${e.id_categoria.capacidad_maxima} personas | $${e.id_categoria.precio_base} MXN`})))}catch(e){console.error("Error al obtener habitaciones:",e)}}function calcularTotalPagar(){let e=0;const t=new Date(a.value),n=(new Date(o.value)-t)/864e5;if(n<=0)return void alert("La fecha de salida debe ser posterior a la de entrada.");y.forEach(t=>{const a=b.find(e=>e.id===t);a&&(e+=parseFloat(a.id_categoria.precio_base)*n)}),totalPagarOriginal=e;const r=parseFloat(l.value)||0,i=document.querySelector('input[name="tipoDescuento"]:checked')?document.querySelector('input[name="tipoDescuento"]:checked').value:"monto";e-="PORCENTAJE"===i?e*r/100:r;const d=parseFloat(s.value)||0;e+=d,e=e<0?0:e;const u=parseFloat(m.value)||0;e-=u,e=e<0?0:e,c.value=e.toFixed(2)}function resetearModal(){document.getElementById("nombre").value="",document.getElementById("apellidos").value="",document.getElementById("documento_identidad").value="",document.getElementById("telefono").value="",document.getElementById("direccion").value="",document.getElementById("observaciones").value="",n.value="",a.value="",o.value="",c.value="",m.value="",l.value="",s.value="",f.clearChoices();const t=document.getElementById("selectHabitacion");if(t)for(let e of t.options)e.selected=!1;e.value="",E=1,document.getElementById("step1").classList.remove("d-none"),document.getElementById("step2").classList.add("d-none"),document.getElementById("step3").classList.add("d-none"),document.getElementById("btnConfirmar").classList.add("d-none"),i.classList.add("d-none"),r.classList.remove("d-none")}r.addEventListener("click",()=>{switch(E){case 1:document.getElementById("nombre").value.trim()||guardarClienteNuevo();const e=document.getElementById("nombre").value.trim(),t=document.getElementById("telefono").value.trim();if(!e||!t)return void mostrarAlerta("Campos Obligatorios","El nombre y el teléfono son obligatorios para crear reservación","warning");cambiarPaso(2),actualizarBarraProgreso(66);break;case 2:if(y=f.getValue(!0),0===y.length)return void mostrarAlerta("No selecciono habitaciones","Por favor, seleccione una habitación.","warning");cambiarPaso(3),calcularTotalPagar(),r.classList.add("d-none"),d.classList.remove("d-none"),actualizarBarraProgreso(100)}}),a.addEventListener("change",cargarHabitaciones),o.addEventListener("change",cargarHabitaciones),i.addEventListener("click",()=>{E>1&&cambiarPaso(E-1)}),e.addEventListener("input",()=>{clearTimeout(u);const a=e.value.trim();a.length<3?t.classList.add("d-none"):u=setTimeout(async()=>{mostrarSugerencias(await buscarClientes(a))},300)}),document.addEventListener("click",a=>{e.contains(a.target)||t.contains(a.target)||t.classList.add("d-none")}),d.addEventListener("click",async()=>{let t=0;y.forEach(e=>{const a=b.find(t=>t.id===e);a&&(t+=parseFloat(a.id_categoria.precio_base))});const n=parseFloat(l.value)||0,r=document.querySelector('input[name="tipoDescuento"]:checked').value;t-="PORCENTAJE"===r?t*n/100:n;const i=parseFloat(s.value)||0;t+=i;const d=parseFloat(document.getElementById("adelanto").value)||0;t-=d,t=t<0?0:t,c.value=t.toFixed(2);let m={};m=g.correo?g:{correo:e.value,nombre:document.getElementById("nombre").value,apellidos:document.getElementById("apellidos").value,documento_identidad:document.getElementById("documento_identidad").value,telefono:document.getElementById("telefono").value,direccion:document.getElementById("direccion").value};const u=new FormData,E={cliente:{correo:m.correo,nombre:m.nombre,apellidos:m.apellidos,documento_identidad:m.documento_identidad,telefono:m.telefono,direccion:m.direccion},fechas:{entrada:a.value+" 14:00:00",salida:o.value+" 12:00:00"},habitaciones:y,pago:{totalPagar:t.toFixed(2),totalPagarOriginal:totalPagarOriginal.toFixed(2),descuento:"PORCENTAJE"===r?totalPagarOriginal*n/100:n,tipoDescuento:r,cobroExtra:i,adelanto:d.toFixed(2)},observaciones:document.getElementById("observaciones").value.trim(),metodo_pago:document.getElementById("metodoPago").value},f=JSON.stringify(E);u.append("reserva",f);try{const e=await fetch("/api/reservaciones",{method:"POST",body:u});if(!e.ok)throw new Error("Error en la respuesta del servidor");const t=await e.json();mostrarAlerta3(t.titulo,t.mensaje,t.tipo)}catch(e){console.error("Error en la solicitud:",e),mostrarAlerta("Error","Hubo un problema al procesar la solicitud","error")}}),l.addEventListener("input",calcularTotalPagar),s.addEventListener("input",calcularTotalPagar),m.addEventListener("input",calcularTotalPagar)}if("/admin/reservaciones"===window.location.pathname&&document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("calendar"),t=document.getElementById("modalReservacion"),a=new bootstrap.Modal(t);let o=[];var n=new FullCalendar.Calendar(e,{displayEventTime:!1,locale:"es",initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},buttonText:{today:"Hoy",prev:"Anterior",next:"Siguiente",month:"Mes",week:"Semana",day:"Día",list:"Lista"},allDayText:"Todo el día",events:[],dateClick:function(e){var t=document.getElementById("start");t?t.value=e.dateStr:console.error("El input con ID 'start' no se encontró.");c&&c.clearChoices();a.show()}});n.render(),document.querySelector("#btnAgregarReservacion").addEventListener("click",(function(){a.show()})),fetch("http://localhost:3000/api/reservaciones").then(e=>e.json()).then(e=>{e.forEach(e=>{const t={id:e.ID_reserva,title:`${e.habitaciones} | ${e.cliente_nombre}`,start:e.fecha_entrada,end:e.fecha_salida,description:e.estado_descripcion,allDay:!1,color:e.estado_color};n.addEvent(t)})}).catch(e=>console.error("Error al obtener las reservaciones:",e));const r=document.getElementById("modalEditar"),i=new bootstrap.Modal(r);let d,c=null;function l(){const e=c.getValue(!0),t=document.getElementById("fechaEntradaEditar").value,a=document.getElementById("fechaSalidaEditar").value;if(!t||!a||0===e.length)return;const n=new Date(t),r=(new Date(a)-n)/864e5;let i=0;e.forEach(e=>{const t=o.find(t=>t.id.toString()===e);t&&(i+=t.id_categoria.precio_base*r)}),console.log(`Precio total: $${i} MXN`)}n.on("eventClick",(async function(e){await async function(e,t){const a=e.event.id;try{const e=await fetch("/api/reservaciones/"+a);if(!e.ok)throw new Error("Error al obtener la reservación: "+e.statusText);const n=await e.json();d={...n},function(e){document.getElementById("nombreEditar").value=e.cliente_nombre,document.getElementById("searchEmailEditar").value=e.correo,document.getElementById("apellidosEditar").value=e.cliente_apellidos,document.getElementById("documento_identidadEditar").value=e.documento_identidad,document.getElementById("telefonoEditar").value=e.telefono,document.getElementById("direccionEditar").value=e.direccion,document.getElementById("observacionesEditar").value=e.observaciones;let t=e.fecha_entrada.split(" ")[0],a=e.fecha_salida.split(" ")[0];if(document.getElementById("fechaEntradaEditar").value=t,document.getElementById("fechaSalidaEditar").value=a,document.getElementById("adelantoEditar").value=e.adelanto,document.getElementById("cobroExtraEditar").value=e.cobro_extra,"PORCENTAJE"===e.tipo_descuento){let t=e.descuento_aplicado/e.precio_total*100;document.getElementById("descuentoEditar").value=t.toFixed(2),document.getElementById("descuentoPorcentajeEditar").checked=!0,document.getElementById("descuentoMontoEditar").checked=!1}else document.getElementById("descuentoEditar").value=e.descuento_aplicado,document.getElementById("descuentoMontoEditar").checked=!0,document.getElementById("descuentoPorcentajeEditar").checked=!1;document.getElementById("metodoPagoEditar").value=e.metodo_pago,document.getElementById("totalPagarEditar").value=e.precio_pendiente}(n),await async function(e,t,a){const n=document.getElementById("habitacionEditar");try{const r=await fetch(`/api/habitaciones/disponibles/${e}/${t}`);let i=await r.json();const d=a?a.split(",").map(e=>e.trim()):[],s=await fetch("/api/habitaciones");o=await s.json();const m=o.filter(e=>d.includes(e.id.toString()));i=i.filter(e=>!d.includes(e.id.toString())),c||(c=new Choices(n,{removeItemButton:!0,placeholder:!0,placeholderValue:"Seleccione una o más habitaciones",searchEnabled:!1})),c.clearChoices();let u=[];m.forEach(e=>{u.push({value:e.id,label:`Habitación ${e.numero} | ${e.id_categoria.nombre} | Capacidad max. ${e.id_categoria.capacidad_maxima} personas | $${e.id_categoria.precio_base} MXN`,selected:!0})}),i.forEach(e=>{u.push({value:e.id,label:`Habitación ${e.numero} | ${e.id_categoria.nombre} | Capacidad max. ${e.id_categoria.capacidad_maxima} personas | $${e.id_categoria.precio_base} MXN`})}),c.clearStore(),c.setChoices(u),l(),document.getElementById("habitacionEditar").addEventListener("change",(function(){c.getValue(!0);l()})),document.getElementById("fechaEntradaEditar").addEventListener("change",(function(){l()})),document.getElementById("fechaSalidaEditar").addEventListener("change",(function(){l()}))}catch(e){console.error("Error al obtener habitaciones disponibles:",e)}}(n.fecha_entrada.split(" ")[0],n.fecha_salida.split(" ")[0],n.ID_habitacion),t.show()}catch(e){console.error("Error al obtener los datos de la reservación:",e)}}(e,i)}))})),"/admin/usuarios"===window.location.pathname){let e,t=!1;const a={1:"Administrador",2:"General",3:"Limpieza"},o={0:"Inactivo",1:"Activo"},n={destroy:!0,pageLength:5,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[3,8]},{visible:!1,targets:[7]}]};async function initDataTable(){t&&e.destroy();const a=await listarUsers();a.length>0&&llenarTabla(a),e=$("#datatable_users").DataTable(n),t=!0}async function listarUsers(){try{const e=await fetch("/api/usuarios");return await e.json()}catch(e){return console.error("Error al obtener usuarios:",e),[]}}function llenarTabla(e){const t=document.getElementById("tableBody_users");t.innerHTML="",e.forEach((e,n)=>{const r=a[e.rol_id]||"Desconocido",i=o[e.estatus]||"Desconocido",d=`\n                <tr>\n                    <td>${n+1}</td>\n                    <td><img src="/build/img/${e.img}.png" alt="Descripción de la imagen" width="65"></td>\n                    <td>${e.nombre}</td>\n                    <td>${e.apellido}</td>\n                    <td>${e.direccion}</td>\n                    <td>${e.email}</td>\n                    <td>${e.telefono}</td>\n                    <td>******</td> \x3c!-- Ocultamos la contraseña en opciones de la tabla --\x3e\n                    <td>${r}</td>\n                    <td class="text-center">${i}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarUsuario" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#usuarioEditarModal">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarUsuario" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=d})}initDataTable(),document.getElementById("tableBody_users").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarUsuario")){const t=e.target.closest(".btn-eliminarUsuario").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/usuarios/"+t,a=await fetch(e,{method:"DELETE"}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),"success"===o.tipo&&await initDataTable()}catch(e){console.error(e)}}})),document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarUsuario")){const t=e.target.closest(".btnEditarUsuario").dataset.id;try{const e=await fetch("/api/usuarios/"+t);if(!e.ok)throw new Error("Error al obtener usuario: "+e.statusText);const a=await e.json();document.getElementById("nombreEditar").value=a.nombre,document.getElementById("apellidoEditar").value=a.apellido,document.getElementById("direccionEditar").value=a.direccion,document.getElementById("emailEditar").value=a.email,document.getElementById("telefonoEditar").value=a.telefono,document.getElementById("rol_idEditar").value=a.rol_id,document.getElementById("estatusEditar").value=a.estatus;document.getElementById("imgEditar").src=a.img?`/build/img/${a.img}.png`:"/build/img/default.png",document.querySelector(".btnActualizarUsuario").dataset.id=t,$("#usuarioEditarModal").modal("show")}catch(e){console.error("Error al obtener los datos del usuario:",e)}}})),document.getElementById("formEditarUsuario").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarUsuario").dataset.id,a={nombre:document.getElementById("nombreEditar").value.trim(),apellido:document.getElementById("apellidoEditar").value.trim(),direccion:document.getElementById("direccionEditar").value.trim(),email:document.getElementById("emailEditar").value.trim(),telefono:document.getElementById("telefonoEditar").value.trim(),password:document.getElementById("passwordEditar").value.trim(),password2:document.getElementById("password2Editar").value.trim(),rol_id:document.getElementById("rol_idEditar").value.trim(),estatus:document.getElementById("estatusEditar").value.trim(),img:document.getElementById("logoEditar").files[0]};if(a.password===a.password2)if(a.telefono.length>10)mostrarAlerta("Error","Telefono no valido","error");else{delete a.password2;try{const e=new FormData;Object.entries(a).forEach(([t,a])=>e.append(t,a));const o=await fetch("/api/usuarios/"+t,{method:"POST",body:e}),n=await o.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),initDataTable()}catch(e){console.error("Error al actualizar usuario:",e)}}else mostrarAlerta("Error","Las contraseñas no coinciden.","error")}));document.querySelector(".btnSubirUsuario").addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),apellido:document.getElementById("apellido").value.trim(),direccion:document.getElementById("direccion").value.trim(),email:document.getElementById("email").value.trim(),telefono:document.getElementById("telefono").value.trim(),password:document.getElementById("password").value.trim(),password2:document.getElementById("password2").value.trim(),rol_id:document.getElementById("rol_id").value.trim(),estatus:document.getElementById("estatus").value.trim(),img:document.getElementById("logo").files[0]};if(""===t.email||""===t.nombre||""===t.direccion||""===t.password||""===t.password2||""===t.telefono)return void mostrarAlerta2("Todos los campos son necesarios","error");if(t.password!==t.password2)return void mostrarAlerta2("Las contraseñas no coinciden.","error");if(t.telefono.length>10)return void mostrarAlerta2("Telefono no valido","error");if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)){delete t.password2;try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a=await fetch("/api/usuarios",{method:"POST",body:e}),o=await a.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),initDataTable()}catch(e){console.error("Error en la solicitud:",e)}}else mostrarAlerta2("El correo electrónico no tiene un formato válido.","error")}))}
//# sourceMappingURL=bundle.js.map
