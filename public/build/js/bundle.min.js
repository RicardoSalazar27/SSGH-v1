if("/admin/configuracion/informacion"===window.location.pathname){const e=document.getElementById("btnActualizarInfo");function mostrarAlerta(e,t,a){Swal.fire({icon:a,title:e,text:t}).then(()=>{$(".modal").modal("hide"),location.reload()})}e&&e.addEventListener("click",(async function(t){t.preventDefault();const a={id:e.dataset.id,nombre:document.getElementById("nombre").value.trim(),telefono:document.getElementById("telefono").value.trim(),correo:document.getElementById("correo").value.trim(),ubicacion:document.getElementById("ubicacion").value.trim(),img:document.getElementById("logo").files[0]};try{const e=new FormData;Object.entries(a).forEach(([t,a])=>e.append(t,a));const t="/admin/configuracion/informacion/actualizar",n=await fetch(t,{method:"POST",body:e}),o=await n.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo)}catch(e){console.log("error")}}))}if(window.mostrarAlerta=function(e,t,a,n=null){Swal.fire({icon:a,title:e,text:t}).then(()=>{$(".modal").modal("hide"),n&&(window.location.href=n)})},window.mostrarAlerta2=function(e,t){const a=document.getElementById("mensaje-resultado");a.style.display="block",a.textContent=e,a.className="alert alert-"+("error"===t?"danger":"success"===t?"success":"info"),setTimeout(()=>{a.style.display="none"},5e3)},window.mostrarAlerta3=function(e,t,a){Swal.fire({icon:a,title:e,text:t,willClose:()=>{setTimeout(()=>{window.location.reload()},1e3)}}).then(()=>{$(".modal").modal("hide")})},window.obtenerFechaFormateada=function(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`},"/login"===window.location.pathname){const e=document.getElementById("btnIniciarSesion");e&&e.addEventListener("click",(async function(e){e.preventDefault();const t={email:document.getElementById("email").value.trim(),password:document.getElementById("password").value.trim()};if(""!==t.email&&""!==t.password)try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a="/login",n=await fetch(a,{method:"POST",body:e}),o=await n.json();o.autorizado?window.location.href="/admin/index":mostrarAlerta2(o.mensaje,o.tipo)}catch(e){console.log(e)}else mostrarAlerta2("Todos los campos son obligatorios","error")}))}if("/admin/puntodeventa/catalogo"===window.location.pathname){let e,t=!1;const a={destroy:!0,pageLength:5,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[4]}]};async function initDataTable(){t&&e.destroy();const n=await listarProductos();n.length>0&&llenarTabla(n),e=$("#datatable_productos").DataTable(a),t=!0}async function listarProductos(){try{const e=await fetch("/api/productos");return await e.json()}catch(e){return console.error("Error al obtener los productos:",e),[]}}function llenarTabla(e){const t=document.getElementById("tableBody_productos");t.innerHTML="",e.forEach((e,a)=>{const n=`\n                <tr>\n                    <td>${a+1}</td>\n                    <td>${e.nombre}</td>\n                    <td>${e.precio}</td>\n                    <td class="text-center">${e.stock}</td>\n                    <td class="text-center">${e.categoria_producto_id.nombre}</td>\n                    <td class="text-center">${e.codigo_barras}</td>\n                    <td class="text-center">${e.proveedor}</td>\n                    <td>\n                        <img src="/build/img/${e.foto?e.foto+".png":"producto-servicio.png"}" alt="Imagen del producto/servicio" width="65">\n                    </td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarProducto" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarProducto">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarProducto" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=n})}initDataTable(),document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarProducto")){const t=e.target.closest(".btnEditarProducto").dataset.id;try{const e=await fetch("/api/productos/"+t);if(!e.ok)throw new Error("Error al obtener usuario: "+e.statusText);const a=await e.json();document.getElementById("nombreEditar").value=a.nombre,document.getElementById("precioEditar").value=a.precio,document.getElementById("stockEditar").value=a.stock,document.getElementById("categoria_idEditar").value=a.categoria_producto_id,document.getElementById("codigo_barrasEditar").value=a.codigo_barras,document.getElementById("proveedorEditar").value=a.proveedor;document.getElementById("imgEditarP").src=a.foto?`/build/img/${a.foto}.png`:"/build/img/producto-servicio.png",document.querySelector(".btnActualizarProducto").dataset.id=t}catch(e){console.error("Error al obtener los datos del producto:",e)}}})),document.getElementById("formEditarProducto").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarProducto").dataset.id,a={nombre:document.getElementById("nombreEditar").value.trim(),precio:document.getElementById("precioEditar").value.trim(),stock:document.getElementById("stockEditar").value.trim(),categoria_producto_id:document.getElementById("categoria_idEditar").value.trim(),codigo_barras:document.getElementById("codigo_barrasEditar").value.trim(),proveedor:document.getElementById("proveedorEditar").value.trim(),foto:document.getElementById("fotoP").files[0]};if(a.nombre&&a.precio&&a.categoria_producto_id)try{const e=new FormData;Object.entries(a).forEach(([t,a])=>e.append(t,a));const n=await fetch("/api/productos/"+t,{method:"POST",body:e}),o=await n.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo);const r=document.getElementById("fotoP");r.value="",r.value&&r.parentNode.replaceChild(r.cloneNode(!0),r),initDataTable()}catch(e){console.error("Error al actualizar producto:",e)}else mostrarAlerta("Error","No pueden ir vacios.","error")})),document.getElementById("tableBody_productos").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarProducto")){const t=e.target.closest(".btn-eliminarProducto").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/productos/"+t,a=await fetch(e,{method:"DELETE"}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),"success"===n.tipo&&await initDataTable()}catch(e){console.error(e)}}}));document.querySelector(".btnSubirProducto").addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),precio:document.getElementById("precio").value.trim(),stock:document.getElementById("stock").value.trim(),categoria_producto_id:document.getElementById("categoria_id").value.trim(),codigo_barras:document.getElementById("codigo_barras").value.trim(),proveedor:document.getElementById("proveedor").value.trim(),foto:document.getElementById("fotoPN").files[0]};if(""!==t.nombre&&""!==t.precio&&""!==t.stock&&""!==t.categoria_producto_id&&""!==t.codigo_barras)if(12==t.codigo_barras.length)try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a=await fetch("/api/productos",{method:"POST",body:e}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),initDataTable()}catch(e){console.error("Error en la solicitud:",e)}else mostrarAlerta2("Codigo UPC INvalido","error");else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/admin/configuracion/categorias"===window.location.pathname){let e,t=!1;const a={0:"Inactivo",1:"Activo"},n={destroy:!0,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[7]}]};async function initDataTable(){t&&e.destroy();const a=await listarCategorias();a.length>0&&llenarTabla(a),e=$("#datatable_categorias").DataTable(n),t=!0}async function listarCategorias(){try{const e=await fetch("/api/categorias");if(204===e.status)return[];if(!e.ok)throw new Error("Error HTTP: "+e.status);return await e.json()}catch(e){return console.error("Error al obtener categorías:",e),null}}function llenarTabla(e){const t=document.getElementById("tableBody_categorias");t.innerHTML="",e.forEach((e,n)=>{const o=a[e.estado]||"Desconocido",r=`\n                <tr>\n                    <td>${n+1}</td>\n                    <td>${e.nombre}</td>\n                    <td class="text-center">${e.capacidad_maxima}</td>\n                    <td>${e.tipo_cama}</td>\n                    <td>${e.precio_base}</td>\n                    <td>${e.servicios_incluidos}</td>\n                    <td>${o}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarCategoria" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarCategoria">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarCategoria" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=r})}initDataTable(),document.getElementById("tableBody_categorias").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarCategoria")){const t=e.target.closest(".btn-eliminarCategoria").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/categorias/"+t,a=await fetch(e,{method:"DELETE"}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),"success"===n.tipo&&await initDataTable()}catch(e){console.error(e)}}}));let o=null;document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarCategoria")){const t=e.target.closest(".btnEditarCategoria").dataset.id;o=null;try{const e="/api/categorias/"+t,a=await fetch(e);if(!a.ok)throw new Error("Error al obtener categoria: "+a.statusText);const n=await a.json();o={...n},document.getElementById("nombreEditar").value=n.nombre,document.getElementById("capacidad_maximaEditar").value=n.capacidad_maxima,document.getElementById("tipo_camaEditar").value=n.tipo_cama,document.getElementById("precio_baseEditar").value=n.precio_base,document.getElementById("servicios_incluidosEditar").value=n.servicios_incluidos,document.getElementById("estadoEditar").value=n.estado,document.querySelector(".btnActualizarCategoria").dataset.id=t}catch(e){console.log("Error al obtener los datos de la categoria:",e)}}})),document.getElementById("formEditarCategoria").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarCategoria").dataset.id,a={nombre:document.getElementById("nombreEditar").value.trim(),capacidad_maxima:document.getElementById("capacidad_maximaEditar").value.trim(),tipo_cama:document.getElementById("tipo_camaEditar").value.trim(),precio_base:document.getElementById("precio_baseEditar").value.trim(),servicios_incluidos:document.getElementById("servicios_incluidosEditar").value.trim(),estado:document.getElementById("estadoEditar").value.trim()};if(!o)return console.error("Error: No hay datos originales de la categoria"),void mostrarAlerta("Error","No se pudieron comparar los datos originales","error");let n={};if(a.nombre!==o.nombre&&(n.nombre=a.nombre),a.capacidad_maxima!==o.capacidad_maxima&&(n.capacidad_maxima=a.capacidad_maxima),a.tipo_cama!==o.tipo_cama&&(n.tipo_cama=a.tipo_cama),a.precio_base!==o.precio_base&&(n.precio_base=a.precio_base),a.servicios_incluidos!==o.servicios_incluidos&&(n.servicios_incluidos=a.servicios_incluidos),a.estado!==o.estado&&(n.estado=a.estado),0===Object.keys(n).length)return void mostrarAlerta2("No hay cambios por enviar","error");const r=6===Object.keys(n).length?"PUT":"PATCH",i="PUT"===r?a:n;try{const e="/api/categorias/"+t,a=await fetch(e,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok){const e=await respuestaUpdate.json();throw new Error(e.mensaje||"Error desconocido al actualizar")}const n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),initDataTable()}catch(e){console.error("Error al actualizar nivel:",e),mostrarAlerta("Error",e.message,"error")}}));document.querySelector(".btnSubirCategoria").addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),capacidad_maxima:document.getElementById("capacidad_maxima").value.trim(),tipo_cama:document.getElementById("tipo_cama").value.trim(),precio_base:document.getElementById("precio_base").value.trim(),servicios_incluidos:document.getElementById("servicios_incluidos").value.trim(),estado:document.getElementById("estado").value.trim()};if(""!==t.nombre&&""!==t.capacidad_maxima&&""!==t.tipo_cama&&""!==t.precio_base)try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a=await fetch("/api/categorias",{method:"POST",body:e}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),initDataTable(),document.getElementById("nombre").value="",document.getElementById("capacidad_maxima").value="",document.getElementById("tipo_cama").value="",document.getElementById("servicios_incluidos").value="",document.getElementById("precio_base").value="",document.getElementById("estatado").value=""}catch(e){console.error("Error en la solicitud:",e)}else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/admin/salidas/checkout"===window.location.pathname){const e=new URLSearchParams(window.location.search).get("id"),t=document.getElementById("inputPenalidad"),a=document.getElementById("totalPagar"),n=document.getElementById("metodoPago"),o=document.getElementById("btnTerminarReservacion"),r=document.getElementById("grupoEfectivo"),i=document.getElementById("cantidadEfectivo"),d=document.getElementById("feriaCalculada"),c=parseFloat(a.innerText.replace(/,/g,""));let l=c;const s=()=>{let e=parseFloat(t.value);l=c,isNaN(e)||(l+=e),a.innerText=l.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}),n.style.display=l>0?"block":"none",l<=0&&r.classList.add("d-none")};n.addEventListener("change",()=>{"efectivo"===n.value&&l>0?r.classList.remove("d-none"):(r.classList.add("d-none"),i.value="",d.value="")}),i.addEventListener("input",()=>{const e=parseFloat(i.value);if(!isNaN(e)&&e>=l){const t=e-l;d.value=t.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})}else d.value=""}),o.addEventListener("click",(async function(a){if(l>0){if(""===n.value)return a.preventDefault(),void alert("Por favor, selecciona un método de pago.");if("efectivo"===n.value){const e=parseFloat(i.value);if(isNaN(e)||e<l)return a.preventDefault(),void alert("La cantidad en efectivo es insuficiente para cubrir el total.")}const o=parseFloat(t.value)||0,r={id_reserva:e,penalidad:o,deudas_liquidadas:!0},d=await fetch("/api/reservacion/terminar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),c=await d.json();return void mostrarAlerta(c.titulo,c.mensaje,c.tipo,"/admin/salidas")}const o={id_reserva:e,penalidad:0,deudas_liquidadas:!0},r=await fetch("/api/reservacion/terminar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),d=await r.json();mostrarAlerta(d.titulo,d.mensaje,d.tipo,"/admin/salidas")})),s(),t.addEventListener("input",s)}if("/admin/clientes"===window.location.pathname){let e,t=!1;const a={destroy:!0,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[6,7]}]};async function initDataTable(){t&&e.destroy();const n=await listarClientes();n.length>0&&llenarTabla(n),e=$("#datatable_clientes").DataTable(a),t=!0}async function listarClientes(){try{const e=await fetch("/api/clientes");if(204===e.status)return[];if(!e.ok)throw new Error("Error HTTP: "+e.status);return await e.json()}catch(e){return console.error("Error al obtener clientes:",e),null}}function llenarTabla(e){const t=document.getElementById("tableBody_clientes");t.innerHTML="",e.forEach((e,a)=>{const n=`\n                <tr>\n                    <td>${a+1}</td>\n                    <td>${e.nombre}</td>\n                    <td>${e.apellidos}</td>\n                    <td>${e.telefono}</td>\n                    <td>${e.correo}</td>\n                    <td>${e.direccion}</td>\n                    <td>${e.documento_identidad}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarCliente" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarCliente">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarCliente" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=n})}initDataTable();let n=null;document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarCliente")){const t=e.target.closest(".btnEditarCliente").dataset.id;n="";try{const e=await fetch("/api/clientes/"+t);if(!e.ok)throw new Error("Error al obtener cliente: "+e.statusText);const a=await e.json();n={...a},document.getElementById("nombre").value=a.nombre,document.getElementById("apellidos").value=a.apellidos,document.getElementById("direccion").value=a.direccion,document.getElementById("correo").value=a.correo,document.getElementById("telefono").value=a.telefono,document.getElementById("documento_identidad").value=a.documento_identidad,document.querySelector(".btnActualizarCliente").dataset.id=t}catch(e){console.error("Error al obtener los datos del cliente:",e)}}})),document.getElementById("formEditarCliente").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarCliente").dataset.id,a={nombre:document.getElementById("nombre").value.trim(),apellidos:document.getElementById("apellidos").value.trim(),telefono:document.getElementById("telefono").value.trim(),correo:document.getElementById("correo").value.trim(),direccion:document.getElementById("direccion").value.trim(),documento_identidad:document.getElementById("documento_identidad").value.trim()};if(!n)return console.error("Error: No hay datos originales del cliente"),void mostrarAlerta("Error","No se pudieron comparar los datos originales","error");let o={};if(a.nombre!==n.nombre&&(o.nombre=a.nombre),a.apellidos!==n.apellidos&&(o.apellidos=a.apellidos),a.telefono!==n.telefono&&(o.telefono=a.telefono),a.correo!==n.correo&&(o.correo=a.correo),a.direccion!==n.direccion&&(o.direccion=a.direccion),a.documento_identidad!==n.documento_identidad&&(o.documento_identidad=a.documento_identidad),0===Object.keys(o).length)return void mostrarAlerta2("No hay cambios por enviar","error");const r=6===Object.keys(o).length?"PUT":"PATCH",i="PUT"===r?a:o;try{const e=await fetch("/api/clientes/"+t,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!e.ok){const t=await e.json();throw new Error(t.mensaje||"Error desconocido al actualizar")}const a=await e.json();mostrarAlerta(a.titulo,a.mensaje,a.tipo),initDataTable()}catch(e){console.error("Error al actualizar cliente:",e),mostrarAlerta("Error",e.message,"error")}})),document.getElementById("tableBody_clientes").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarCliente")){const t=e.target.closest(".btn-eliminarCliente").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/clientes/"+t,a=await fetch(e,{method:"DELETE"}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),"success"===n.tipo&&await initDataTable()}catch(e){console.error(e)}}}))}if(document.addEventListener("DOMContentLoaded",(function(){var e,t=document.getElementById("barChart").getContext("2d"),a=document.getElementById("periodoSelect");async function n(e){try{const t=await fetch("/api/ganancias?anio=2025&periodo="+e);if(204===t.status)return void o([],[]);const a=await t.json(),n=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],r=a.length>0?a.map(e=>n[e.mes-1]):["Sin datos"];o(r,a.length>0?a.map(e=>parseFloat(e.ganancias)):[0])}catch(e){console.error("Error al cargar datos:",e)}}function o(a,n){e&&e.destroy(),e=new Chart(t,{type:"bar",data:{labels:a,datasets:[{label:"Ganancias",data:n,backgroundColor:"rgba(54, 162, 235, 0.2)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}n(a.value),a.addEventListener("change",(function(){n(this.value)}))})),"/admin/configuracion/habitaciones"===window.location.pathname){let e,t=!1;const a={0:"Inactivo",1:"Activo"},n={destroy:!0,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[4]}]};async function initDataTable(){t&&e.destroy();const a=await listarhabitaciones();a.length>0&&llenarTabla(a),e=$("#datatable_habitaciones").DataTable(n),t=!0}async function listarhabitaciones(){try{const e=await fetch("/api/habitaciones");return await e.json()}catch(e){return console.error("Error al obtener habitaciones:",e),[]}}function llenarTabla(e){const t=document.getElementById("tableBody_habitaciones");t.innerHTML="",e.forEach(e=>{const n=a[e.estatus]||"Desconocido",o=`\n                <tr>\n                    <td>${e.numero}</td>\n                    <td>${e.id_nivel.nombre}</td>\n                    <td>${e.id_categoria.nombre}</td>\n                    <td>${e.id_categoria.precio_base}</td>\n                    <td>${e.id_categoria.servicios_incluidos}</td>\n                    <td>${e.detalles_personalizados}</td>\n                    <td class="text-center">${n}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarHabitacion" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarHabitacion">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarHabitacion" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=o})}initDataTable(),document.getElementById("tableBody_habitaciones").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarHabitacion")){const t=e.target.closest(".btn-eliminarHabitacion").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/habitaciones/"+t,a=await fetch(e,{method:"DELETE"}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),"success"===n.tipo&&await initDataTable()}catch(e){console.error(e)}}}));let o=null;document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarHabitacion")){const t=e.target.closest(".btnEditarHabitacion").dataset.id;o="";try{const e=await fetch("/api/habitaciones/"+t);if(!e.ok)throw new Error("Error al obtener habitación: "+e.statusText);const a=await e.json();console.log(a),o={...a},document.getElementById("numeroEditar").value=a.numero,document.getElementById("id_nivelEditar").value=a.id_nivel.id,document.getElementById("id_categoriaEditar").value=a.id_categoria.id,document.getElementById("detalles_personalizadosEditar").value=a.detalles_personalizados,document.getElementById("estatusEditar").value=a.estatus,document.querySelector(".btnActualizarHabitacion").dataset.id=t}catch(e){console.error("Error al obtener los datos de la habitación:",e)}}})),document.getElementById("formEditarHabitacion").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarHabitacion").dataset.id,a={numero:document.getElementById("numeroEditar").value.trim(),id_nivel:document.getElementById("id_nivelEditar").value.trim(),id_categoria:document.getElementById("id_categoriaEditar").value.trim(),detalles_personalizados:document.getElementById("detalles_personalizadosEditar").value.trim(),estatus:document.getElementById("estatusEditar").value.trim()};if(!o)return console.error("Error: No hay datos originales del habitacion"),void mostrarAlerta("Error","No se pudieron comparar los datos originales","error");let n={};if(a.numero!==o.numero&&(n.numero=a.numero),a.id_nivel!==o.id_nivel&&(n.id_nivel=a.id_nivel),a.id_categoria!==o.id_categoria&&(n.id_categoria=a.id_categoria),a.detalles_personalizados!==o.detalles_personalizados&&(n.detalles_personalizados=a.detalles_personalizados),a.estatus!==o.estatus&&(n.estatus=a.estatus),0===Object.keys(n).length)return void mostrarAlerta2("No hay cambios por enviar","error");const r=a;try{const e=await fetch("/api/habitaciones/"+t,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok){const t=await e.json();throw new Error(t.mensaje||"Error desconocido al actualizar")}const a=await e.json();mostrarAlerta(a.titulo,a.mensaje,a.tipo),initDataTable()}catch(e){console.error("Error al actualizar habitacion:",e),mostrarAlerta("Error",e.message,"error")}}));document.querySelector(".btnSubirHabitacion").addEventListener("click",(async function(e){e.preventDefault();const t={numero:document.getElementById("numero").value.trim(),id_nivel:document.getElementById("id_nivel").value.trim(),id_categoria:document.getElementById("id_categoria").value.trim(),detalles_personalizados:document.getElementById("detalles_personalizados").value.trim(),estatus:document.getElementById("estatus").value.trim()};if(""!==t.id_nivel&&""!==t.numero&&""!==t.id_categoria)try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a=await fetch("/api/habitaciones",{method:"POST",body:e}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),initDataTable(),document.getElementById("numero").value="",document.getElementById("detalles_personalizados").value="",document.getElementById("estatus").value="1"}catch(e){console.error("Error en la solicitud:",e)}else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/admin/configuracion/niveles"===window.location.pathname){let e,t=!1;const a={0:"Inactivo",1:"Activo"},n={destroy:!0,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[4]}]};async function initDataTable(){t&&e.destroy();const a=await listarNiveles();a.length>0&&llenarTabla(a),e=$("#datatable_niveles").DataTable(n),t=!0}async function listarNiveles(){try{const e=await fetch("/api/niveles");return await e.json()}catch(e){return console.error("Error al obtener niveles:",e),[]}}function llenarTabla(e){const t=document.getElementById("tableBody_niveles");t.innerHTML="",e.forEach((e,n)=>{const o=a[e.estatus]||"Desconocido",r=`\n                <tr>\n                    <td>${n+1}</td>\n                    <td>${e.nombre}</td>\n                    <td>${e.numero}</td>\n                    <td class="text-center">${o}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarNivel" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#modalEditarNivel">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarNivel" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=r})}initDataTable(),document.getElementById("tableBody_niveles").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarNivel")){const t=e.target.closest(".btn-eliminarNivel").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/niveles/"+t,a=await fetch(e,{method:"DELETE"}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),"success"===n.tipo&&await initDataTable()}catch(e){console.error(e)}}}));let o=null;document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarNivel")){const t=e.target.closest(".btnEditarNivel").dataset.id;o="";try{const e=await fetch("/api/niveles/"+t);if(!e.ok)throw new Error("Error al obtener nivel: "+e.statusText);const a=await e.json();o={...a},document.getElementById("nombreEditar").value=a.nombre,document.getElementById("numeroEditar").value=a.numero,document.getElementById("estatusEditar").value=a.estatus,document.querySelector(".btnActualizarNivel").dataset.id=t}catch(e){console.error("Error al obtener los datos del nivel:",e)}}})),document.getElementById("formEditarNivel").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarNivel").dataset.id,a={nombre:document.getElementById("nombreEditar").value.trim(),numero:document.getElementById("numeroEditar").value.trim(),estatus:document.getElementById("estatusEditar").value.trim()};if(!o)return console.error("Error: No hay datos originales del nivel"),void mostrarAlerta("Error","No se pudieron comparar los datos originales","error");let n={};if(a.nombre!==o.nombre&&(n.nombre=a.nombre),a.numero!==o.numero&&(n.numero=a.numero),a.estatus!==o.estatus&&(n.estatus=a.estatus),0===Object.keys(n).length)return void mostrarAlerta2("No hay cambios por enviar","error");const r=3===Object.keys(n).length?"PUT":"PATCH",i="PUT"===r?a:n;try{const e=await fetch("/api/niveles/"+t,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!e.ok){const t=await e.json();throw new Error(t.mensaje||"Error desconocido al actualizar")}const a=await e.json();mostrarAlerta(a.titulo,a.mensaje,a.tipo),initDataTable()}catch(e){console.error("Error al actualizar nivel:",e),mostrarAlerta("Error",e.message,"error")}}));document.querySelector(".btnSubirNivel").addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),numero:document.getElementById("numero").value.trim(),estatus:document.getElementById("estatus").value.trim()};if(""!==t.nombre&&""!==t.numero)try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a=await fetch("/api/niveles",{method:"POST",body:e}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),initDataTable(),document.getElementById("nombre").value="",document.getElementById("numero").value="",document.getElementById("estatus").value=""}catch(e){console.error("Error en la solicitud:",e)}else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/admin/puntodeventa/venta/directa"===window.location.pathname){new URLSearchParams(window.location.search);const e=document.getElementById("inputBuscarProducto"),t=document.getElementById("listaSugerencias"),a=document.getElementById("tablaVentaProductos"),n=(document.getElementById("grupoMetodoPago"),document.getElementById("grupoEfectivo")),o=document.getElementById("metodoPago"),r=document.getElementById("cantidadEfectivo"),i=document.getElementById("feriaCalculada"),d=document.getElementById("totalPagarVenta"),c=document.getElementById("terminarVenta");let l=[],s=[],u=0;function renderSugerencias(a){t.innerHTML="",Array.isArray(a)&&0!==a.length?a.forEach(a=>{const n=document.createElement("li");n.classList.add("list-group-item","list-group-item-action"),n.textContent=`${a.codigo_barras} - ${a.nombre}`,n.addEventListener("click",()=>{agregarProducto(a),limpiarLista(),e.value=""}),t.appendChild(n)}):t.innerHTML='<li class="list-group-item">No se encontraron productos</li>',t.classList.remove("d-none")}function limpiarLista(){t.innerHTML="",t.classList.add("d-none")}function agregarProducto(e){const t=parseFloat(e.precio);let a=l.find(t=>t.codigo_barras===e.codigo_barras);a?(a.cantidad++,a.total=a.cantidad*t):l.push({id_producto:e.id,codigo_barras:e.codigo_barras,nombre:e.nombre,proveedor:e.proveedor,precio:parseFloat(e.precio),foto:e.foto,cantidad:1,total:t,stock:e.stock}),actualizarTabla()}function actualizarTabla(){a.innerHTML="",l.forEach(e=>{const t=document.createElement("tr");t.innerHTML=`\n                <td>${e.nombre}</td>\n                <td>${e.proveedor}</td>\n                <td>\n                    <div class="d-flex justify-content-center align-items-center gap-2">\n                        <button class="btn btn-sm btn-outline-secondary btn-restar" data-id="${e.codigo_barras}">-</button>\n                        <span class="cantidad">${e.cantidad}</span>\n                        <button class="btn btn-sm btn-outline-secondary btn-sumar" data-id="${e.codigo_barras}" ${e.cantidad>=e.stock?"disabled":""}>+</button>\n                    </div>\n                </td>\n                <td>$${parseFloat(e.precio).toFixed(2)}</td>\n                <td>$${e.total.toFixed(2)}</td>\n                <td><img src="/build/img/${e.foto?e.foto+".png":"producto-servicio.png"}" alt="Imagen del producto/servicio" width="65"></td>\n                <td><button class="btn btn-danger btn-sm" data-id="${e.codigo_barras}" id="eliminarProducto">Eliminar</button></td>\n            `,a.appendChild(t)}),agregarEventosEliminar(),agregarEventosContador(),calcularTotal()}function agregarEventosEliminar(){document.querySelectorAll("#eliminarProducto").forEach(e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-id");eliminarProducto(e)}))})}function eliminarProducto(e){l=l.filter(t=>t.codigo_barras!==e),actualizarTabla()}function agregarEventosContador(){const e=document.querySelectorAll(".btn-sumar"),t=document.querySelectorAll(".btn-restar");e.forEach(e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-id"),t=l.find(t=>t.codigo_barras===e);t&&t.cantidad<t.stock&&(t.cantidad++,t.total=t.cantidad*parseFloat(t.precio)),actualizarTabla()}))}),t.forEach(e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-id"),t=l.find(t=>t.codigo_barras===e);t&&t.cantidad>1&&(t.cantidad--,t.total=t.cantidad*parseFloat(t.precio)),actualizarTabla()}))})}function calcularTotal(){u=0,l.forEach(e=>{u+=e.total});document.getElementById("totalPagarVenta").value=""+u.toFixed(2)}e.addEventListener("input",async e=>{const a=e.target.value.trim();if(a.length>=3)try{const e="/api/productos/codigo/"+a,t=await fetch(e);s=await t.json(),renderSugerencias(s)}catch(e){console.error("Error al buscar productos:",e),t.innerHTML='<li class="list-group-item text-danger">Error en la búsqueda</li>',t.classList.remove("d-none")}else limpiarLista()}),document.addEventListener("click",(function(a){e.contains(a.target)||t.contains(a.target)||limpiarLista()})),o.addEventListener("change",()=>{"2"===o.value&&n.classList.add("d-none"),"3"===o.value&&n.classList.add("d-none"),"1"===o.value&&n.classList.remove("d-none")}),r.addEventListener("input",()=>{const e=d.value,t=(parseFloat(e)||0)-(parseFloat(r.value)||0);i.value=Math.abs(t)}),c.addEventListener("click",async()=>{if(0===l.length)return void mostrarAlerta("Opps.","El carrito está vacío","warning");let e=0;try{const t=await fetch("/api/usuario/activo"),a=await t.json();e=a.id}catch(e){console.error(e)}const t=l.map(t=>({producto_id:Number(t.id_producto),cantidad:Number(t.cantidad),monto:t.cantidad*t.precio,descripcion:t.nombre,usuario_id:e,estado:1})),a=l.map(e=>({producto_id:Number(e.id_producto),cantidad:Number(e.cantidad)})),n=JSON.stringify({ventas:t,productos:a});try{const e=await fetch("/api/productos/reservacion/vender",{method:"POST",headers:{"Content-Type":"application/json"},body:n}),t=await e.json();mostrarAlerta(t.titulo,t.mensaje,t.tipo,"/admin/puntodeventa/vender")}catch(e){console.error(e)}})}if("/admin/puntodeventa/vender/reserva"===window.location.pathname){const e=new URLSearchParams(window.location.search).get("id"),t=document.getElementById("inputBuscarProducto"),a=document.getElementById("listaSugerencias"),n=document.getElementById("tablaVentaProductos"),o=document.getElementById("cuandoPagar"),r=document.getElementById("grupoMetodoPago"),i=document.getElementById("grupoEfectivo"),d=document.getElementById("metodoPago"),c=document.getElementById("cantidadEfectivo"),l=document.getElementById("feriaCalculada"),s=document.getElementById("totalPagarVenta"),u=document.getElementById("terminarVenta");let m=[],g=[],E=0;function renderSugerencias(e){a.innerHTML="",Array.isArray(e)&&0!==e.length?e.forEach(e=>{const n=document.createElement("li");n.classList.add("list-group-item","list-group-item-action"),n.textContent=`${e.codigo_barras} - ${e.nombre}`,n.addEventListener("click",()=>{agregarProducto(e),limpiarLista(),t.value=""}),a.appendChild(n)}):a.innerHTML='<li class="list-group-item">No se encontraron productos</li>',a.classList.remove("d-none")}function limpiarLista(){a.innerHTML="",a.classList.add("d-none")}function agregarProducto(e){const t=parseFloat(e.precio);let a=m.find(t=>t.codigo_barras===e.codigo_barras);a?(a.cantidad++,a.total=a.cantidad*t):m.push({id_producto:e.id,codigo_barras:e.codigo_barras,nombre:e.nombre,proveedor:e.proveedor,precio:parseFloat(e.precio),foto:e.foto,cantidad:1,total:t,stock:e.stock}),actualizarTabla()}function actualizarTabla(){n.innerHTML="",m.forEach(e=>{const t=document.createElement("tr");t.innerHTML=`\n                <td>${e.nombre}</td>\n                <td>${e.proveedor}</td>\n                <td>\n                    <div class="d-flex justify-content-center align-items-center gap-2">\n                        <button class="btn btn-sm btn-outline-secondary btn-restar" data-id="${e.codigo_barras}">-</button>\n                        <span class="cantidad">${e.cantidad}</span>\n                        <button class="btn btn-sm btn-outline-secondary btn-sumar" data-id="${e.codigo_barras}" ${e.cantidad>=e.stock?"disabled":""}>+</button>\n                    </div>\n                </td>\n                <td>$${parseFloat(e.precio).toFixed(2)}</td>\n                <td>$${e.total.toFixed(2)}</td>\n                <td><img src="/build/img/${e.foto?e.foto+".png":"producto-servicio.png"}" alt="Imagen del producto/servicio" width="65"></td>\n                <td><button class="btn btn-danger btn-sm" data-id="${e.codigo_barras}" id="eliminarProducto">Eliminar</button></td>\n            `,n.appendChild(t)}),agregarEventosEliminar(),agregarEventosContador(),calcularTotal()}function agregarEventosEliminar(){document.querySelectorAll("#eliminarProducto").forEach(e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-id");eliminarProducto(e)}))})}function eliminarProducto(e){m=m.filter(t=>t.codigo_barras!==e),actualizarTabla()}function agregarEventosContador(){const e=document.querySelectorAll(".btn-sumar"),t=document.querySelectorAll(".btn-restar");e.forEach(e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-id"),t=m.find(t=>t.codigo_barras===e);t&&t.cantidad<t.stock&&(t.cantidad++,t.total=t.cantidad*parseFloat(t.precio)),actualizarTabla()}))}),t.forEach(e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-id"),t=m.find(t=>t.codigo_barras===e);t&&t.cantidad>1&&(t.cantidad--,t.total=t.cantidad*parseFloat(t.precio)),actualizarTabla()}))})}function calcularTotal(){E=0,m.forEach(e=>{E+=e.total});document.getElementById("totalPagarVenta").value=""+E.toFixed(2)}t.addEventListener("input",async e=>{const t=e.target.value.trim();if(t.length>=3)try{const e="/api/productos/codigo/"+t,a=await fetch(e);g=await a.json(),renderSugerencias(g)}catch(e){console.error("Error al buscar productos:",e),a.innerHTML='<li class="list-group-item text-danger">Error en la búsqueda</li>',a.classList.remove("d-none")}else limpiarLista()}),document.addEventListener("click",(function(e){t.contains(e.target)||a.contains(e.target)||limpiarLista()})),o.addEventListener("change",()=>{"1"===o.value?(r.classList.remove("d-none"),i.classList.remove("d-none")):(r.classList.add("d-none"),i.classList.add("d-none"),c.value="",l.value="")}),d.addEventListener("change",()=>{"2"===d.value&&i.classList.add("d-none"),"3"===d.value&&i.classList.add("d-none"),"1"===d.value&&i.classList.remove("d-none")}),c.addEventListener("input",()=>{const e=s.value,t=(parseFloat(e)||0)-(parseFloat(c.value)||0);l.value=Math.abs(t)}),u.addEventListener("click",async()=>{if(0===m.length)return void mostrarAlerta("Opps.","El carrito está vacío","warning");if(!o.value)return void mostrarAlerta("Opps.","Falta seleccionar método de pago","warning");let t=0;try{const e=await fetch("/api/usuario/activo"),a=await e.json();t=a.id}catch(e){console.error(e)}const a=m.map(a=>({reservacion_id:Number(e),producto_id:Number(a.id_producto),cantidad:Number(a.cantidad),monto:a.cantidad*a.precio,descripcion:a.nombre,usuario_id:t,estado:"1"===o.value?1:0})),n=m.map(e=>({producto_id:Number(e.id_producto),cantidad:Number(e.cantidad)})),r=JSON.stringify({ventas:a,productos:n});console.log(r);try{const e=await fetch("/api/productos/reservacion/vender",{method:"POST",headers:{"Content-Type":"application/json"},body:r}),t=await e.json();mostrarAlerta(t.titulo,t.mensaje,t.tipo,"/admin/puntodeventa/vender")}catch(e){console.error(e)}})}if("/admin/recepcion"===window.location.pathname){function actualizarEstadoHabitacion(e,t){fetch("/api/habitaciones/"+e,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_estado_habitacion:t})}).then(e=>{if(!e.ok)throw new Error("HTTP error! Status: "+e.status);return e.json()}).then(e=>{Swal.fire({title:"Habitación nuevamente disponible",icon:"success"}).then(()=>{location.reload()})}).catch(e=>{console.error("Error:",e),Swal.fire({title:"Error al actualizar",text:"No se pudo cambiar la habitación.",icon:"error"})})}document.querySelectorAll(".small-box-footer").forEach(e=>{const t=e.getAttribute("data-id"),a=e.getAttribute("data-estado");3!=a&&6!=a&&8!=a||e.addEventListener("click",e=>{e.preventDefault(),Swal.fire({title:"¿Limpieza Terminada?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, confirmar!"}).then(e=>{if(e.isConfirmed){let e;3==a?e=2:6==a?e=1:8==a&&(e=5),void 0!==e?actualizarEstadoHabitacion(t,e):console.error("Error: nuevoEstado no está definido.")}})})})}if("/admin/recepcion/habitacion"===window.location.pathname){const e=document.getElementById("sugerenciaCorreo"),t=document.getElementById("correo"),a=document.getElementById("nombre"),n=document.getElementById("apellidos"),o=document.getElementById("documento"),r=document.getElementById("telefono"),i=document.getElementById("direccion"),d=document.querySelector(".btnCrearCliente"),c=document.getElementById("nombreNuevoCliente"),l=document.getElementById("apellidosNuevoCliente"),s=document.getElementById("correoNuevoCliente"),u=document.getElementById("telefonoNuevoCliente"),m=document.getElementById("documento_identidadNuevoCliente"),g=document.getElementById("direccionNuevoCliente");let E="";const p=document.getElementById("fechaEntrada"),b=document.getElementById("fechaSalida"),f=document.querySelectorAll("input[name='tipoDescuento']"),v=document.getElementById("descuento"),y=document.getElementById("cobroExtra"),h=document.getElementById("adelanto"),B=document.getElementById("totalPagar"),w=parseFloat(document.getElementById("precio_habitacion").textContent.trim())||0,I=document.getElementById("metodoPago"),_=document.getElementById("observaciones");let T=1,$=T*w,L=$,x=0,S="",C=0,j=0;async function buscarClientes(t){if(t.length<3)e.classList.add("d-none");else try{const e=await fetch("/api/clientes/correo/"+encodeURIComponent(t));if(!e.ok)throw new Error("Error HTTP: "+e.status);const a=await e.json();mostrarSugerencias(a)}catch(t){console.error("Error al obtener clientes:",t),e.classList.add("d-none")}}function mostrarSugerencias(t){e.innerHTML="",0!==t.length?(e.classList.remove("d-none"),t.forEach(t=>{const a=document.createElement("li");a.classList.add("list-group-item","list-group-item-action"),a.textContent=t.correo,a.dataset.id=t.id,a.addEventListener("click",()=>seleccionarCliente(t)),e.appendChild(a)})):e.classList.add("d-none")}function seleccionarCliente(d){t.value=d.correo,a.value=d.nombre,n.value=d.apellidos,o.value=d.documento_identidad,r.value=d.telefono,i.value=d.direccion,e.classList.add("d-none")}function calcularNoches(){const e=new Date(p.value),t=new Date(b.value);T=isNaN(e)||isNaN(t)||t<=e?1:(t-e)/864e5}function calcularTotalPagar(){$=T*w,x=parseFloat(v.value)||0,C=parseFloat(y.value)||0,j=parseFloat(h.value)||0;const e=document.querySelector("input[name='tipoDescuento']:checked");S=e?e.value:"";let t=$;"PORCENTAJE"===S?(x=$*(x/100),t-=x):"MONTO"===S&&(t-=x),L=t+C-j,B.value=L.toFixed(2)}function actualizarCalculo(){calcularNoches(),calcularTotalPagar()}t.addEventListener("input",e=>{buscarClientes(e.target.value)}),document.addEventListener("click",a=>{t.contains(a.target)||e.contains(a.target)||e.classList.add("d-none")}),d.addEventListener("click",e=>{e.preventDefault(),E={nombre:c.value.trim(),apellidos:l.value.trim(),correo:s.value.trim(),telefono:u.value.trim(),documento_identidad:m.value.trim(),direccion:g.value.trim()},E.nombre&&E.apellidos&&E.telefono?(a.value=E.nombre+" "+E.apellidos,t.value=E.correo??"",o.value=E.documento_identidad??"",r.value=E.telefono,i.value=E.direccion??"",mostrarAlerta("Huesped Agregado","Datos capturados con exito","info")):mostrarAlerta2("Datos Incompletos: El nombre, apellidos y telefono son obligatorios","error")}),[p,b,v,y,h].forEach(e=>{e.addEventListener("input",actualizarCalculo)}),f.forEach(e=>{e.addEventListener("change",actualizarCalculo)}),actualizarCalculo();const D=I.value,A=_.value.trim();document.getElementById("reservarHabitacion").addEventListener("click",async e=>{e.preventDefault();const d=new Date,c=`${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}:${String(d.getSeconds()).padStart(2,"0")}`,l=`${p.value} ${c}`;if(!a.value.trim()||!n.value.trim()||!r.value.trim())return void mostrarAlerta("Faltan datos del Huesped","El nombre, apellidos y telefono son obligatorios","warning");const s=new URLSearchParams(window.location.search).get("id"),u={cliente:{correo:t.value.trim(),nombre:a.value.trim(),apellidos:n.value.trim(),documento_identidad:o.value.trim(),telefono:r.value.trim(),direccion:i.value.trim()},fechas:{entrada:l,salida:b.value+" 12:00:00"},habitaciones:[s],pago:{totalPagar:parseFloat(L),totalPagarOriginal:parseFloat($),descuento:parseFloat(x),tipoDescuento:S,cobroExtra:parseFloat(C),adelanto:parseFloat(j)},observaciones:A,metodo_pago:D},m=new FormData;m.append("reserva",JSON.stringify(u));try{const e=await fetch("/api/reservaciones",{method:"POST",body:m});if(!e.ok)throw new Error("Error en la respuesta del servidor");const t=await e.json();mostrarAlerta(t.titulo,t.mensaje,t.tipo,"/admin/recepcion")}catch(e){console.error("Error:",e),mostrarAlerta("Error","No se pudo enviar la reserva","error")}})}if("/registro"===window.location.pathname){const e=document.getElementById("crear-cuenta");e&&e.addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),apellido:document.getElementById("apellidos").value.trim(),email:document.getElementById("email").value.trim(),password:document.getElementById("password").value.trim(),password2:document.getElementById("password2").value.trim(),telefono:document.getElementById("telefono").value.trim(),direccion:document.getElementById("direccion").value.trim()};if(""!==t.email&&""!==t.nombre&&""!==t.direccion&&""!==t.password&&""!==t.password2&&""!==t.telefono)if(t.password===t.password2){delete t.password2;try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a="/registro",n=await fetch(a,{method:"POST",body:e}),o=await n.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo,"/login")}catch(e){console.log("Error en la solicitud:",e)}}else mostrarAlerta2("Las contraseñas no coinciden","error");else mostrarAlerta2("Todos los campos son necesarios","error")}))}if("/admin/registro-actividades"===window.location.pathname){let e,t=!1;const a={destroy:!0,pageLength:10,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[4]}]};async function initDataTable(){t&&e.destroy();const n=await obtenerActividades();n.length>0&&llenarTabla(n),e=$("#tabla-actividades").DataTable(a),t=!0}async function obtenerActividades(){try{const e=await fetch("/api/registro-actividades");if(!e.ok)throw new Error("Error al obtener actividades");return await e.json()}catch(e){return console.error("Error al obtener actividades:",e),[]}}function llenarTabla(e){const t=document.querySelector("#tabla-actividades tbody");t.innerHTML="",e.forEach((e,a)=>{const n=`\n                <tr>\n                    <td>${a+1}</td>\n                    <td>${e.nombre_usuario}</td>\n                    <td>${e.telefono}</td>\n                    <td><span class="badge badge-info">${e.accion}</span></td>\n                    <td>${e.detalle}</td>\n                    <td>${e.fecha}</td>\n                    <td>${e.hora}</td>\n                </tr>\n            `;t.innerHTML+=n})}initDataTable()}if("/admin/reporte-diario"===window.location.pathname){let e,t,a,n,o,r,i=!1,d=!1;const c="/api/hotel";async function obtenerNombreHotel(){try{const e=await fetch(c),t=await e.json();a=t.nombre||"Tu Nombre Hotel",n=t.telefono||"Tu Telefono",o=t.correo||"Tu Correo",r=t.ubicacion||"Tu Ubicacion"}catch(e){console.error("Error al obtener el nombre del hotel:",e)}}function obtenerFechaFormateada(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}let l=0,s=0,u=0,m=0,g=0,E=0;const p={responsive:!0,paging:!0,ordering:!0,info:!0,language:{url:"//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"},dom:'<"d-flex justify-content-between align-items-center mb-2"fB>rtip'};async function initReportesDiarios(){await obtenerNombreHotel();const c=obtenerFechaFormateada(),l=`Generado el: ${c} \n        Teléfono: ${n} | Correo: ${o} | Ubicación: ${r}`,s="Reporte de Reservaciones - "+a,u="Reporte de Ventas y Servicios - "+a,m="reservaciones_"+c.replace(/[\s:]/g,"_"),g="servicios_"+c.replace(/[\s:]/g,"_"),E={...p,buttons:[{extend:"excelHtml5",title:s,messageTop:l,filename:m,text:'<i class="fas fa-file-excel"></i> Excel',className:"btn btn-success btn-sm"},{extend:"pdfHtml5",title:s,messageTop:l,filename:m,text:'<i class="fas fa-file-pdf"></i> PDF',className:"btn btn-danger btn-sm",orientation:"landscape",pageSize:"A4",exportOptions:{columns:":visible",modifier:{page:"all"}},customize:function(e){e.defaultStyle.fontSize=10,e.styles.tableHeader.fontSize=12}}]},b={...p,buttons:[{extend:"excelHtml5",title:u,messageTop:l,filename:g,text:'<i class="fas fa-file-excel"></i> Excel',className:"btn btn-success btn-sm"},{extend:"pdfHtml5",title:u,messageTop:l,filename:g,text:'<i class="fas fa-file-pdf"></i> PDF',className:"btn btn-danger btn-sm",orientation:"portrait",pageSize:"A4",exportOptions:{columns:":visible",modifier:{page:"all"}},customize:function(e){e.defaultStyle.fontSize=10,e.styles.tableHeader.fontSize=12}}]},f=`/api/reporte-diario/${document.getElementById("usuario").value||"null"}/${document.getElementById("fecha").value}`;try{const a=await fetch(f),{reservas:n,ventas:o}=await a.json();i&&e.destroy(),d&&t.destroy(),llenarTablaReservas(n),llenarTablaServicios(o),e=$("#tablaReservas").DataTable(E),t=$("#tablaServicios").DataTable(b),i=!0,d=!0}catch(e){console.error("Error al obtener reporte diario:",e)}}function llenarTablaReservas(e){const t=document.querySelector("#tablaReservas tbody");t.innerHTML="",l=0,s=0,u=0,e.forEach((e,a)=>{const n=`\n                <tr>\n                    <td>${a+1}</td>\n                    <td>${e.No_Reserva}</td>\n                    <td>${e.Huesped}</td>\n                    <td>${e.Habitaciones}</td>\n                    <td>MXN$${e.Precio_Total}</td>\n                    <td>MXN$${e.Descuento}</td>\n                    <td>MXN$${e.Cobro_Extra}</td>\n                    <td>MXN$${e.Adelanto}</td>\n                    <td>MXN$${e.Penalidad}</td>\n                    <td>MXN$${e.Ventas_Servicios}</td>\n                    <td>MXN$${e.Total}</td>\n                    <td>${e.Tiempo_Rebasado}</td>\n                </tr>\n            `;t.innerHTML+=n;const o=parseFloat(e.Ventas_Servicios||0),r=parseFloat(e.Total||0);l+=o,s+=r-o}),u=l+s,document.getElementById("totalVentas").textContent="MXN$"+l.toLocaleString("es-MX",{minimumFractionDigits:2}),document.getElementById("totalReservas").textContent="MXN$"+s.toLocaleString("es-MX",{minimumFractionDigits:2}),document.getElementById("totalGeneral").textContent="MXN$"+u.toLocaleString("es-MX",{minimumFractionDigits:2})}function llenarTablaServicios(e){const t=document.querySelector("#tablaServicios tbody");t.innerHTML="",m=0,g=0,E=0,e.forEach((e,a)=>{const n=`\n                <tr>\n                    <td>${a+1}</td>\n                    <td>${e.Identificador}</td>\n                    <td>${e.Tipo}</td>\n                    <td>${e.Reserva??"-"}</td>\n                    <td>${e.Habitacion??"-"}</td>\n                    <td>${e.Articulo}</td>\n                    <td>${e.Cantidad}</td>\n                    <td>MXN$${e.Precio_Unitario}</td>\n                    <td>MXN$${e.Total}</td>\n                    <td>${e.Hora}</td>\n                </tr>\n            `;t.innerHTML+=n;const o=parseFloat(e.Total||0);"huésped"===e.Tipo.toLowerCase()||"huesped"===e.Tipo.toLowerCase()?g+=o:"público"!==e.Tipo.toLowerCase()&&"publico"!==e.Tipo.toLowerCase()||(m+=o)}),E=g+m,document.getElementById("totalVentasDirecta").textContent="MXN$"+m.toFixed(2),document.getElementById("totalVentasReservacion").textContent="MXN$"+g.toFixed(2),document.getElementById("totalVentasGeneral").textContent="MXN$"+E.toFixed(2)}document.addEventListener("DOMContentLoaded",initReportesDiarios),document.getElementById("usuario").addEventListener("change",initReportesDiarios),document.getElementById("fecha").addEventListener("change",initReportesDiarios)}if("/admin/reporte-mensual"===window.location.pathname){let e,t,a,n,o,r,i=!1,d=!1;const c="/api/hotel";async function obtenerDatosHotel(){try{const e=await fetch(c),t=await e.json();a=t.nombre||"Tu Nombre Hotel",n=t.telefono||"Tu Teléfono",o=t.correo||"Tu Correo",r=t.ubicacion||"Tu Ubicación"}catch(e){console.error("Error al obtener datos del hotel:",e)}}function obtenerFechaFormateada(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}let l=0,s=0,u=0,m=0,g=0,E=0;const p={responsive:!0,paging:!0,ordering:!0,info:!0,language:{url:"//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"},dom:'<"d-flex justify-content-between align-items-center mb-2"fB>rtip'};async function initReporteMensual(){await obtenerDatosHotel();const c=obtenerFechaFormateada(),l=`Generado el: ${c}\n        Teléfono: ${n} | Correo: ${o} | Ubicación: ${r}`,s="Reporte de Reservaciones - "+a,u="Reporte de Ventas y Servicios - "+a,m="reservaciones_"+c.replace(/[\s:]/g,"_"),g="servicios_"+c.replace(/[\s:]/g,"_"),E={...p,buttons:[{extend:"excelHtml5",title:s,messageTop:l,filename:m,text:'<i class="fas fa-file-excel"></i> Excel',className:"btn btn-success btn-sm"},{extend:"pdfHtml5",title:s,messageTop:l,filename:m,text:'<i class="fas fa-file-pdf"></i> PDF',className:"btn btn-danger btn-sm",orientation:"landscape",pageSize:"A4",exportOptions:{columns:":visible",modifier:{page:"all"}},customize:function(e){e.defaultStyle.fontSize=10,e.styles.tableHeader.fontSize=12}}]},b={...p,buttons:[{extend:"excelHtml5",title:u,messageTop:l,filename:g,text:'<i class="fas fa-file-excel"></i> Excel',className:"btn btn-success btn-sm"},{extend:"pdfHtml5",title:u,messageTop:l,filename:g,text:'<i class="fas fa-file-pdf"></i> PDF',className:"btn btn-danger btn-sm",orientation:"portrait",pageSize:"A4",exportOptions:{columns:":visible",modifier:{page:"all"}},customize:function(e){e.defaultStyle.fontSize=10,e.styles.tableHeader.fontSize=12}}]},f=`/api/reporte-mensual/${document.getElementById("usuario").value||"null"}/${document.getElementById("mes").value}/${document.getElementById("anio").value}`;try{const a=await fetch(f),{reservas:n,ventas:o}=await a.json();i&&e.destroy(),d&&t.destroy(),llenarTablaReservas(n),llenarTablaServicios(o),e=$("#tablaReservas").DataTable(E),t=$("#tablaServicios").DataTable(b),i=!0,d=!0}catch(e){console.error("Error al obtener reporte mensual:",e)}}function llenarTablaReservas(e){const t=document.querySelector("#tablaReservas tbody");t.innerHTML="",e.forEach((e,a)=>{const n=`\n                <tr>\n                    <td>${a+1}</td>\n                    <td>${e.No_Reserva}</td>\n                    <td>${e.Huesped}</td>\n                    <td>${e.Habitaciones}</td>\n                    <td>MXN$${e.Precio_Total}</td>\n                    <td>MXN$${e.Descuento}</td>\n                    <td>MXN$${e.Cobro_Extra}</td>\n                    <td>MXN$${e.Adelanto}</td>\n                    <td>MXN$${e.Penalidad}</td>\n                    <td>MXN$${e.Ventas_Servicios}</td>\n                    <td>MXN$${e.Total}</td>\n                    <td>${e.Tiempo_Rebasado}</td>\n                </tr>\n            `;t.innerHTML+=n;const o=parseFloat(e.Ventas_Servicios||0),r=parseFloat(e.Total||0);l+=o,s+=r-o}),u=l+s,document.getElementById("totalVentasMensual").textContent="MXN$"+l.toLocaleString("es-MX",{minimumFractionDigits:2}),document.getElementById("totalReservasMensual").textContent="MXN$"+s.toLocaleString("es-MX",{minimumFractionDigits:2}),document.getElementById("totalGeneralMensual").textContent="MXN$"+u.toLocaleString("es-MX",{minimumFractionDigits:2})}function llenarTablaServicios(e){const t=document.querySelector("#tablaServicios tbody");t.innerHTML="",e.forEach((e,a)=>{const n=`\n                <tr>\n                    <td>${a+1}</td>\n                    <td>${e.Identificador}</td>\n                    <td>${e.Tipo}</td>\n                    <td>${e.Reserva??"-"}</td>\n                    <td>${e.Habitacion??"-"}</td>\n                    <td>${e.Articulo}</td>\n                    <td>${e.Cantidad}</td>\n                    <td>${e.Precio_Unitario}</td>\n                    <td>${e.Total}</td>\n                    <td>${e.Hora}</td>\n                </tr>\n            `;t.innerHTML+=n;const o=parseFloat(e.Total||0);"huésped"===e.Tipo.toLowerCase()||"huesped"===e.Tipo.toLowerCase()?g+=o:"público"!==e.Tipo.toLowerCase()&&"publico"!==e.Tipo.toLowerCase()||(m+=o)}),E=g+m,document.getElementById("totalVentasDirectaMensual").textContent="MXN$"+m.toFixed(2),document.getElementById("totalVentasReservacionMensual").textContent="MXN$"+g.toFixed(2),document.getElementById("totalVentasGeneralMensual").textContent="MXN$"+E.toFixed(2)}document.addEventListener("DOMContentLoaded",initReporteMensual),document.getElementById("usuario").addEventListener("change",initReporteMensual),document.getElementById("mes").addEventListener("change",initReporteMensual),document.getElementById("anio").addEventListener("change",initReporteMensual)}if("/admin/reservaciones"===window.location.pathname){const e=document.getElementById("searchEmail"),t=document.getElementById("sugerenciasCorreo"),a=document.getElementById("fechaEntrada"),n=document.getElementById("fechaSalida"),o=document.getElementById("habitacion"),r=document.getElementById("btnSiguiente"),i=document.getElementById("btnAtras"),d=document.getElementById("btnConfirmar"),c=document.getElementById("totalPagar"),l=document.getElementById("descuento"),s=document.getElementById("cobroExtra"),u=document.getElementById("adelanto");let m,g={},E=1,p=[],b=[];const f=new Choices(o,{removeItemButton:!0,placeholder:!0,placeholderValue:"Seleccione una o más habitaciones",searchEnabled:!1});async function buscarClientes(e){try{const t=await fetch("/api/clientes/correo/"+encodeURIComponent(e));return await t.json()}catch(e){return console.error("Error al obtener clientes:",e),[]}}function mostrarSugerencias(e){t.innerHTML="",0!==e.length?(t.classList.remove("d-none"),e.forEach(e=>{const a=document.createElement("li");a.classList.add("list-group-item","list-group-item-action"),a.textContent=e.correo,a.dataset.id=e.id,a.addEventListener("click",()=>seleccionarCliente(e)),t.appendChild(a)})):t.classList.add("d-none")}function seleccionarCliente(a){e.value=a.correo,document.getElementById("nombre").value=a.nombre,document.getElementById("apellidos").value=a.apellidos,document.getElementById("documento_identidad").value=a.documento_identidad,document.getElementById("telefono").value=a.telefono,document.getElementById("direccion").value=a.direccion,t.classList.add("d-none")}function guardarClienteNuevo(){g={correo:e.value.trim(),nombre:document.getElementById("nombre").value.trim(),apellidos:document.getElementById("apellidos").value.trim(),documento_identidad:document.getElementById("documento_identidad").value.trim(),telefono:document.getElementById("telefono").value.trim(),direccion:document.getElementById("direccion").value.trim()}}const v=document.getElementById("progressBar");function actualizarBarraProgreso(e){v.style.width=e+"%",v.setAttribute("aria-valuenow",e),v.textContent=e+"%"}function cambiarPaso(e){document.getElementById("step"+E).classList.add("d-none"),document.getElementById("step"+e).classList.remove("d-none"),E=e,i.classList.toggle("d-none",1===E),3===E?(r.textContent="Registrar",d.classList.remove("d-none"),r.classList.add("d-none")):(r.textContent="Siguiente",d.classList.add("d-none"),r.classList.remove("d-none"))}async function cargarHabitaciones(){if(a.value&&n.value)try{const e=await fetch(`/api/habitaciones/disponibles/${a.value}/${n.value}`);if(p=await e.json(),f.clearChoices(),0===p.length)return void f.setChoices([{value:"",label:"No hay habitaciones disponibles",disabled:!0}]);f.setChoices(p.map(e=>({value:e.id,label:`Habitación ${e.numero} | ${e.id_categoria.nombre} | Capacidad max. ${e.id_categoria.capacidad_maxima} personas | $${e.id_categoria.precio_base} MXN`})))}catch(e){console.error("Error al obtener habitaciones:",e)}}function calcularTotalPagar(){let e=0;const t=new Date(a.value),o=(new Date(n.value)-t)/864e5;if(o<=0)return void alert("La fecha de salida debe ser posterior a la de entrada.");b.forEach(t=>{const a=p.find(e=>e.id===t);a&&(e+=parseFloat(a.id_categoria.precio_base)*o)}),totalPagarOriginal=e;const r=parseFloat(l.value)||0,i=document.querySelector('input[name="tipoDescuento"]:checked')?document.querySelector('input[name="tipoDescuento"]:checked').value:"monto";e-="PORCENTAJE"===i?e*r/100:r;const d=parseFloat(s.value)||0;e+=d,e=e<0?0:e;const m=parseFloat(u.value)||0;e-=m,e=e<0?0:e,c.value=e.toFixed(2)}function resetearModal(){document.getElementById("nombre").value="",document.getElementById("apellidos").value="",document.getElementById("documento_identidad").value="",document.getElementById("telefono").value="",document.getElementById("direccion").value="",document.getElementById("observaciones").value="",o.value="",a.value="",n.value="",c.value="",u.value="",l.value="",s.value="",f.clearChoices();const t=document.getElementById("selectHabitacion");if(t)for(let e of t.options)e.selected=!1;e.value="",E=1,document.getElementById("step1").classList.remove("d-none"),document.getElementById("step2").classList.add("d-none"),document.getElementById("step3").classList.add("d-none"),document.getElementById("btnConfirmar").classList.add("d-none"),i.classList.add("d-none"),r.classList.remove("d-none")}r.addEventListener("click",()=>{switch(E){case 1:document.getElementById("nombre").value.trim()||guardarClienteNuevo();const e=document.getElementById("nombre").value.trim(),t=document.getElementById("telefono").value.trim();if(!e||!t)return void mostrarAlerta("Campos Obligatorios","El nombre y el teléfono son obligatorios para crear reservación","warning");cambiarPaso(2),actualizarBarraProgreso(66);break;case 2:if(b=f.getValue(!0),0===b.length)return void mostrarAlerta("No selecciono habitaciones","Por favor, seleccione una habitación.","warning");cambiarPaso(3),calcularTotalPagar(),r.classList.add("d-none"),d.classList.remove("d-none"),actualizarBarraProgreso(100)}}),a.addEventListener("change",cargarHabitaciones),n.addEventListener("change",cargarHabitaciones),i.addEventListener("click",()=>{E>1&&cambiarPaso(E-1)}),e.addEventListener("input",()=>{clearTimeout(m);const a=e.value.trim();a.length<3?t.classList.add("d-none"):m=setTimeout(async()=>{mostrarSugerencias(await buscarClientes(a))},300)}),document.addEventListener("click",a=>{e.contains(a.target)||t.contains(a.target)||t.classList.add("d-none")}),d.addEventListener("click",async()=>{let t=0;b.forEach(e=>{const a=p.find(t=>t.id===e);a&&(t+=parseFloat(a.id_categoria.precio_base))});const o=parseFloat(l.value)||0,r=document.querySelector('input[name="tipoDescuento"]:checked').value;t-="PORCENTAJE"===r?t*o/100:o;const i=parseFloat(s.value)||0;t+=i;const d=parseFloat(document.getElementById("adelanto").value)||0;t-=d;let c={};c=g.correo?g:{correo:e.value,nombre:document.getElementById("nombre").value,apellidos:document.getElementById("apellidos").value,documento_identidad:document.getElementById("documento_identidad").value,telefono:document.getElementById("telefono").value,direccion:document.getElementById("direccion").value};const u=new FormData,m=document.getElementById("totalPagar").value,E={cliente:{correo:c.correo,nombre:c.nombre,apellidos:c.apellidos,documento_identidad:c.documento_identidad,telefono:c.telefono,direccion:c.direccion},fechas:{entrada:a.value+" 14:00:00",salida:n.value+" 12:00:00"},habitaciones:b,pago:{totalPagar:m,totalPagarOriginal:totalPagarOriginal.toFixed(2),descuento:"PORCENTAJE"===r?totalPagarOriginal*o/100:o,tipoDescuento:r,cobroExtra:i,adelanto:d.toFixed(2)},observaciones:document.getElementById("observaciones").value.trim(),metodo_pago:document.getElementById("metodoPago").value},f=JSON.stringify(E);u.append("reserva",f);try{const e=await fetch("/api/reservaciones",{method:"POST",body:u});if(!e.ok)throw new Error("Error en la respuesta del servidor");const t=await e.json();mostrarAlerta3(t.titulo,t.mensaje,t.tipo)}catch(e){console.error("Error en la solicitud:",e),mostrarAlerta("Error","Hubo un problema al procesar la solicitud","error")}}),l.addEventListener("input",calcularTotalPagar),s.addEventListener("input",calcularTotalPagar),u.addEventListener("input",calcularTotalPagar)}if("/admin/reservaciones"===window.location.pathname&&document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("calendar"),t=document.getElementById("modalReservacion"),a=new bootstrap.Modal(t);let n=[];var o=new FullCalendar.Calendar(e,{displayEventTime:!1,locale:"es",initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},buttonText:{today:"Hoy",prev:"Anterior",next:"Siguiente",month:"Mes",week:"Semana",day:"Día",list:"Lista"},allDayText:"Todo el día",events:[],dateClick:function(e){var t=document.getElementById("start");t?t.value=e.dateStr:console.error("El input con ID 'start' no se encontró.");c&&c.clearChoices();a.show()}});o.render(),document.querySelector("#btnAgregarReservacion").addEventListener("click",(function(){a.show()})),fetch("/api/reservaciones").then(e=>e.json()).then(e=>{e.forEach(e=>{const t={id:e.ID_reserva,title:`${e.habitaciones} | ${e.cliente_nombre}`,start:e.fecha_entrada,end:e.fecha_salida,description:e.estado_descripcion,allDay:!1,color:e.estado_color};o.addEvent(t)})}).catch(e=>console.error("Error al obtener las reservaciones:",e));const r=document.getElementById("modalEditar"),i=new bootstrap.Modal(r);let d,c=null,l=0;function s(){const e=c.getValue(!0),t=document.getElementById("fechaEntradaEditar").value,a=document.getElementById("fechaSalidaEditar").value;if(!t||!a||0===e.length)return;const o=new Date(t),r=(new Date(a)-o)/864e5;let i=0;e.forEach(e=>{const t=n.find(t=>t.id.toString()===e);t&&(i+=t.id_categoria.precio_base*r)}),l=i;const d=parseFloat(document.getElementById("adelantoEditar").value)||0,s=parseFloat(document.getElementById("cobroExtraEditar").value)||0,u=parseFloat(document.getElementById("descuentoEditar").value)||0,m=document.getElementById("descuentoPorcentajeEditar").checked;i-=m?i*(u/100):u,i+=s,i-=d,console.log(`Precio total: $${i.toFixed(2)} MXN`);document.getElementById("totalPagarEditar").value=i.toFixed(2)}o.on("eventClick",(async function(e){await async function(e,t){const a=e.event.id;try{const e=await fetch("/api/reservaciones/"+a);if(!e.ok)throw new Error("Error al obtener la reservación: "+e.statusText);const o=await e.json();d={...o},function(e){document.getElementById("idReservacion").value=e.ID_reserva,document.getElementById("nombreEditar").value=e.cliente_nombre,document.getElementById("searchEmailEditar").value=e.correo,document.getElementById("apellidosEditar").value=e.cliente_apellidos,document.getElementById("documento_identidadEditar").value=e.documento_identidad,document.getElementById("telefonoEditar").value=e.telefono,document.getElementById("direccionEditar").value=e.direccion,document.getElementById("observacionesEditar").value=e.observaciones;let t=e.fecha_entrada.split(" ")[0],a=e.fecha_salida.split(" ")[0];if(document.getElementById("fechaEntradaEditar").value=t,document.getElementById("fechaSalidaEditar").value=a,document.getElementById("adelantoEditar").value=e.adelanto,document.getElementById("cobroExtraEditar").value=e.cobro_extra,"PORCENTAJE"===e.tipo_descuento){let t=e.descuento_aplicado/e.precio_total*100;document.getElementById("descuentoEditar").value=t.toFixed(2),document.getElementById("descuentoPorcentajeEditar").checked=!0,document.getElementById("descuentoMontoEditar").checked=!1}else document.getElementById("descuentoEditar").value=e.descuento_aplicado,document.getElementById("descuentoMontoEditar").checked=!0,document.getElementById("descuentoPorcentajeEditar").checked=!1;document.getElementById("metodoPagoEditar").value=e.metodo_pago,document.getElementById("estatusEditar").value=e.ID_estado,document.getElementById("totalPagarEditar").value=e.precio_pendiente}(o),await async function(e,t,a){const o=document.getElementById("habitacionEditar");try{const r=await fetch(`/api/habitaciones/disponibles/${e}/${t}`);let i=await r.json();const d=a?a.split(",").map(e=>e.trim()):[],l=await fetch("/api/habitaciones");n=await l.json();const u=n.filter(e=>d.includes(e.id.toString()));i=i.filter(e=>!d.includes(e.id.toString())),c||(c=new Choices(o,{removeItemButton:!0,placeholder:!0,placeholderValue:"Seleccione una o más habitaciones",searchEnabled:!1})),c.clearChoices();let m=[];u.forEach(e=>{m.push({value:e.id,label:`Habitación ${e.numero} | ${e.id_categoria.nombre} | Capacidad max. ${e.id_categoria.capacidad_maxima} personas | $${e.id_categoria.precio_base} MXN`,selected:!0})}),i.forEach(e=>{m.push({value:e.id,label:`Habitación ${e.numero} | ${e.id_categoria.nombre} | Capacidad max. ${e.id_categoria.capacidad_maxima} personas | $${e.id_categoria.precio_base} MXN`})}),c.clearStore(),c.setChoices(m),s(),document.getElementById("habitacionEditar").addEventListener("change",(function(){c.getValue(!0);s()})),document.getElementById("fechaEntradaEditar").addEventListener("change",(function(){s()})),document.getElementById("fechaSalidaEditar").addEventListener("change",(function(){s()}))}catch(e){console.error("Error al obtener habitaciones disponibles:",e)}}(o.fecha_entrada.split(" ")[0],o.fecha_salida.split(" ")[0],o.ID_habitacion),t.show()}catch(e){console.error("Error al obtener los datos de la reservación:",e)}}(e,i)})),document.getElementById("fechaEntradaEditar").addEventListener("change",s),document.getElementById("fechaSalidaEditar").addEventListener("change",s),document.getElementById("adelantoEditar").addEventListener("input",s),document.getElementById("cobroExtraEditar").addEventListener("input",s),document.getElementById("descuentoEditar").addEventListener("input",s),document.getElementById("descuentoPorcentajeEditar").addEventListener("change",s),document.getElementById("descuentoMontoEditar").addEventListener("change",s),document.getElementById("btnEditar").addEventListener("click",(async function(e){e.preventDefault();const t=document.getElementById("idReservacion").value,a={cliente:{correo:document.getElementById("searchEmailEditar").value.trim(),nombre:document.getElementById("nombreEditar").value.trim(),apellidos:document.getElementById("apellidosEditar").value.trim(),documento_identidad:document.getElementById("documento_identidadEditar").value.trim(),telefono:document.getElementById("telefonoEditar").value.trim(),direccion:document.getElementById("direccionEditar").value.trim()},fechas:{entrada:document.getElementById("fechaEntradaEditar").value.trim()+" 14:00:00",salida:document.getElementById("fechaSalidaEditar").value.trim()+" 12:00:00"},habitaciones:c.getValue(!0),pago:{totalPagar:parseFloat(document.getElementById("totalPagarEditar").value.trim())||0,totalPagarOriginal:parseFloat(l||0).toFixed(2),descuento:document.getElementById("descuentoPorcentajeEditar").checked?(l||0)*(parseFloat(document.getElementById("descuentoEditar").value.trim())||0)/100:parseFloat(document.getElementById("descuentoEditar").value.trim())||0,tipoDescuento:document.getElementById("descuentoPorcentajeEditar").checked?"PORCENTAJE":"MONTO",cobroExtra:parseFloat(document.getElementById("cobroExtraEditar").value.trim())||0,adelanto:parseFloat(document.getElementById("adelantoEditar").value.trim())||0},observaciones:document.getElementById("observacionesEditar").value.trim(),metodo_pago:document.getElementById("metodoPagoEditar").value.trim(),ID_estado:document.getElementById("estatusEditar").value};try{document.getElementById("loadingSpinner").classList.remove("d-none");const e=await fetch("/api/reservaciones/"+t,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(document.getElementById("loadingSpinner").classList.add("d-none"),!e.ok){const t=await e.json();throw new Error(t.mensaje||"Error desconocido al actualizar")}const n=await e.json();mostrarAlerta3(n.titulo,n.mensaje,n.tipo),$("#modalEditar").modal("hide")}catch(e){console.error("Error al actualizar la reservación:",e),mostrarAlerta("Error",e.message,"error")}}))})),document.addEventListener("DOMContentLoaded",(function(){const e=window.location.pathname;document.querySelectorAll(".nav-link").forEach(t=>{if((!t.hash||t.href.replace(t.hash,"")!==window.location.href.replace(window.location.hash,""))&&t.pathname===e){t.classList.add("active");const e=t.closest(".nav-item");e&&e.classList.add("menu-open");const a=t.closest(".nav-treeview");if(a){const e=a.closest(".nav-item");if(e){e.classList.add("menu-open");const t=e.querySelector("a.nav-link");t&&t.classList.add("active")}a.style.display="block"}}})})),"/admin/recibos"===window.location.pathname&&$("#datatable_recibos").DataTable({pageLength:10,lengthChange:!0,order:[[0,"desc"]],language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"}}),"/admin/usuarios"===window.location.pathname){let e,t=!1;const a={1:"Administrador",2:"General",3:"Limpieza"},n={0:"Inactivo",1:"Activo"},o={destroy:!0,language:{url:"https://cdn.datatables.net/plug-ins/2.1.8/i18n/es-MX.json"},dom:'<"row mb-2"<"d-flex justify-content-start col-sm-6"f>><"row"<"col-sm-12"tr>><"row d-flex justify-content-between"<"col d-flex justify-content-start"l><"col d-flex justify-content-center"i><"col d-flex justify-content-end"p>>',columnDefs:[{orderable:!1,targets:[3,8]},{visible:!1,targets:[7]}]};async function initDataTable(){t&&e.destroy();const a=await listarUsers();a.length>0&&llenarTabla(a),e=$("#datatable_users").DataTable(o),t=!0}async function listarUsers(){try{const e=await fetch("/api/usuarios");return await e.json()}catch(e){return console.error("Error al obtener usuarios:",e),[]}}function llenarTabla(e){const t=document.getElementById("tableBody_users");t.innerHTML="",e.forEach((e,o)=>{const r=a[e.rol_id]||"Desconocido",i=n[e.estatus]||"Desconocido",d=`\n                <tr>\n                    <td>${o+1}</td>\n                    <td><img src="/build/img/${e.img?e.img:"user"}.png" alt="Imagen-usuario" width="65"></td>\n                    <td>${e.nombre}</td>\n                    <td>${e.apellido}</td>\n                    <td>${e.direccion}</td>\n                    <td>${e.email}</td>\n                    <td>${e.telefono}</td>\n                    <td>******</td> \x3c!-- Ocultamos la contraseña en opciones de la tabla --\x3e\n                    <td>${r}</td>\n                    <td class="text-center">${i}</td>\n                    <td>\n                        \x3c!-- Botón de editar que abre el modal --\x3e\n                        <button \n                            class="btn btn-sm btn-primary btnEditarUsuario" \n                            data-id="${e.id}" \n                            data-toggle="modal" \n                            data-target="#usuarioEditarModal">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        \x3c!-- Botón de eliminar --\x3e\n                        <button class="btn btn-sm btn-danger btn-eliminarUsuario" data-id="${e.id}">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </td>\n                </tr>\n            `;t.innerHTML+=d})}initDataTable(),document.getElementById("tableBody_users").addEventListener("click",(async function(e){if(e.target.closest(".btn-eliminarUsuario")){const t=e.target.closest(".btn-eliminarUsuario").getAttribute("data-id");if((await Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const e="/api/usuarios/"+t,a=await fetch(e,{method:"DELETE"}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),"success"===n.tipo&&await initDataTable()}catch(e){console.error(e)}}})),document.addEventListener("click",(async function(e){if(e.target.closest(".btnEditarUsuario")){const t=e.target.closest(".btnEditarUsuario").dataset.id;try{const e=await fetch("/api/usuarios/"+t);if(!e.ok)throw new Error("Error al obtener usuario: "+e.statusText);const a=await e.json();document.getElementById("nombreEditar").value=a.nombre,document.getElementById("apellidoEditar").value=a.apellido,document.getElementById("direccionEditar").value=a.direccion,document.getElementById("emailEditar").value=a.email,document.getElementById("telefonoEditar").value=a.telefono,document.getElementById("rol_idEditar").value=a.rol_id,document.getElementById("estatusEditar").value=a.estatus;document.getElementById("imgEditar").src=a.img?`/build/img/${a.img}.png`:"/build/img/user.png",document.querySelector(".btnActualizarUsuario").dataset.id=t,$("#usuarioEditarModal").modal("show")}catch(e){console.error("Error al obtener los datos del usuario:",e)}}})),document.getElementById("formEditarUsuario").addEventListener("submit",(async function(e){e.preventDefault();const t=document.querySelector(".btnActualizarUsuario").dataset.id,a={nombre:document.getElementById("nombreEditar").value.trim(),apellido:document.getElementById("apellidoEditar").value.trim(),direccion:document.getElementById("direccionEditar").value.trim(),email:document.getElementById("emailEditar").value.trim(),telefono:document.getElementById("telefonoEditar").value.trim(),password:document.getElementById("passwordEditar").value.trim(),password2:document.getElementById("password2Editar").value.trim(),rol_id:document.getElementById("rol_idEditar").value.trim(),estatus:document.getElementById("estatusEditar").value.trim(),img:document.getElementById("logoEditar").files[0]};if(a.password===a.password2)if(a.telefono.length>10)mostrarAlerta("Error","Telefono no valido","error");else{delete a.password2;try{const e=new FormData;Object.entries(a).forEach(([t,a])=>e.append(t,a));const n=await fetch("/api/usuarios/"+t,{method:"POST",body:e}),o=await n.json();mostrarAlerta(o.titulo,o.mensaje,o.tipo),initDataTable()}catch(e){console.error("Error al actualizar usuario:",e)}}else mostrarAlerta("Error","Las contraseñas no coinciden.","error")}));document.querySelector(".btnSubirUsuario").addEventListener("click",(async function(e){e.preventDefault();const t={nombre:document.getElementById("nombre").value.trim(),apellido:document.getElementById("apellido").value.trim(),direccion:document.getElementById("direccion").value.trim(),email:document.getElementById("email").value.trim(),telefono:document.getElementById("telefono").value.trim(),password:document.getElementById("password").value.trim(),password2:document.getElementById("password2").value.trim(),rol_id:document.getElementById("rol_id").value.trim(),estatus:document.getElementById("estatus").value.trim(),img:document.getElementById("logo").files[0]};if(""===t.email||""===t.nombre||""===t.direccion||""===t.password||""===t.password2||""===t.telefono)return void mostrarAlerta2("Todos los campos son necesarios","error");if(t.password!==t.password2)return void mostrarAlerta2("Las contraseñas no coinciden.","error");if(t.telefono.length>10)return void mostrarAlerta2("Telefono no valido","error");if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)){delete t.password2;try{const e=new FormData;Object.entries(t).forEach(([t,a])=>e.append(t,a));const a=await fetch("/api/usuarios",{method:"POST",body:e}),n=await a.json();mostrarAlerta(n.titulo,n.mensaje,n.tipo),initDataTable()}catch(e){console.error("Error en la solicitud:",e)}}else mostrarAlerta2("El correo electrónico no tiene un formato válido.","error")}))}
//# sourceMappingURL=bundle.js.map
